var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)},B=Blockly,iface,pxt;!function(e){!function(t){function o(t,o){return e.worker.getWorker(e.webConfig.workerjs).opAsync(t,o)}function i(e,t){e.push.apply(e,t)}function r(e){if(!e)throw new Error("Assertion failure")}function n(e,t){var o=new Error(e);throw o.block=t,o}function l(e){return e.link?l(e.link):e}function a(e,t){var o=l(e),i=l(t);if(r(null==o.link&&null==i.link),o!=i){if(o.childType&&i.childType){var n=o.childType;o.childType=null,a(n,i.childType)}else o.childType&&!i.childType&&(i.childType=o.childType);if(o.parentType&&i.parentType){var s=o.parentType;o.parentType=null,a(s,i.parentType)}else o.parentType&&!i.parentType&&(i.parentType=o.parentType);var c=p(o.type,i.type);e.link=i,o.link=i,e.type=null,t.type=c}}function s(e){return new xe(null,e)}function c(e){if(!e)return s(e);switch(e.toLowerCase()){case"number":return Ee;case"boolean":return Be;case"string":return Ae;case"void":return Ce;default:return s(e)}}function u(e,t){if(r(null!=t),"placeholder"==t.type||t.type===pxtc.TS_OUTPUT_TYPE)return l(t.p);if("variables_get"==t.type)return l(G(e,K(t.getFieldValue("VAR"),e)).type);if(!t.outputConnection)return c(Ce.type);var o=t.outputConnection.check_&&t.outputConnection.check_.length?t.outputConnection.check_[0]:"T";if("Array"===o){var i=void 0;if(t.inputList&&t.inputList.length)for(var n=0,a=t.inputList;n<a.length;n++){var p=a[n];if(p.connection&&p.connection.targetBlock()){var h=l(u(e,p.connection.targetBlock()));if(h){if(h.parentType)return h.parentType;y(i=c(h.type+"[]"),h);break}}}return i||c("Array")}if("T"===o){var m=e.stdCallTable[t.type],f="lists_index_get"===t.type;if(f||m&&m.args.length){var g=void 0;if((g=f?t.inputList.filter(function(e){return"LIST"===e.name})[0]:t.inputList.filter(function(e){return e.name===m.args[0].field})[0]).connection&&g.connection.targetBlock()){var b=u(e,g.connection.targetBlock());if(b.childType)return b.childType;var k=s(d(b.type)?b.type.substr(-2):null);return y(b,k),k}}return s(null)}return c(o)}function p(e,t){if(null==e||"Array"===e&&d(t))return t;if(null==t||"Array"===t&&d(e))return e;if(e==t)return e;throw new Error("cannot mix "+e+" with "+t)}function d(e){return e&&-1!==e.indexOf("[]")}function h(e,t,o){return{type:"placeholder",p:s(o||null),workspace:e.workspace,parentBlock_:t}}function m(e,t,o,i){var r=t.getInputTargetBlock(o);r?r.type!==pxtc.TS_OUTPUT_TYPE||r.p||(r.p=s(null)):(_e[t.id]||(_e[t.id]={}),_e[t.id][o]||(_e[t.id][o]=h(e,t,i)))}function f(e,t){var o=e.getInputTargetBlock(t);return o||_e[e.id]&&_e[e.id][t]}function g(){_e={}}function b(e,t,o,i){try{m(e,t,o),a(u(e,f(t,o)),i)}catch(e){n("The parameter "+o+" of this block is of the wrong type. More precisely: "+e,t)}}function k(e,t){function o(e){return e.name?e.connection&&e.connection.check_&&e.connection.check_.length?e.connection.check_[0]:"T":void 0}function i(t,i){var r=t.inputList.filter(function(e){return"T"===o(e)});if(r.length){var n=f(t,r[0].name);if(n){var l=u(e,n),a=c(l.type?u(e,n).type+"[]":null);return y(a,l),b(e,t,i,a),!0}}return!1}t&&t.getAllBlocks().filter(function(e){return!e.disabled}).forEach(function(t){try{switch(t.type){case"math_op2":b(e,t,"x",c(Ee.type)),b(e,t,"y",c(Ee.type));break;case"math_op3":b(e,t,"x",c(Ee.type));break;case"math_arithmetic":case"logic_compare":switch(t.getFieldValue("OP")){case"ADD":case"MINUS":case"MULTIPLY":case"DIVIDE":case"LT":case"LTE":case"GT":case"GTE":case"POWER":b(e,t,"A",c(Ee.type)),b(e,t,"B",c(Ee.type));break;case"AND":case"OR":m(e,t,"A",Be.type),m(e,t,"B",Be.type);break;case"EQ":case"NEQ":m(e,t,"A"),m(e,t,"B");var r=u(e,f(t,"A")),s=u(e,f(t,"B"));try{a(r,s)}catch(e){n("Comparing objects of different types",t)}var p=l(r).type;p!=Ae.type&&p!=Be.type&&p!=Ee.type&&null!=p&&n("I can only compare strings, booleans and numbers",t)}break;case"logic_operation":m(e,t,"A",Be.type),m(e,t,"B",Be.type);break;case"logic_negate":m(e,t,"BOOL",Be.type);break;case"controls_if":for(var d=0;d<=t.elseifCount_;++d)m(e,t,"IF"+d,Be.type);break;case"controls_simple_for":b(e,t,"TO",c(Ee.type));break;case"controls_for_of":b(e,t,"LIST",c("Array")),y(u(e,f(t,"LIST")),G(e,K(t.getFieldValue("VAR"),e)).type);break;case"variables_set":case"variables_change":var h=K(t.getFieldValue("VAR"),e),g=G(e,h).type;m(e,t,"VALUE");var k=f(t,"VALUE");if(k){var v=u(e,k);try{a(g,v)}catch(e){n("Assigning a value of the wrong type to variable "+h,t)}}break;case"controls_repeat_ext":b(e,t,"TIMES",c(Ee.type));break;case"device_while":m(e,t,"COND",Be.type);break;case"lists_index_get":b(e,t,"LIST",c("Array")),b(e,t,"INDEX",c(Ee.type)),y(u(e,f(t,"LIST")),u(e,t));break;case"lists_index_set":b(e,t,"LIST",c("Array")),m(e,t,"VALUE"),i(t,"LIST"),b(e,t,"INDEX",c(Ee.type));break;default:if(t.type in e.stdCallTable){var _=e.stdCallTable[t.type];_.args.forEach(function(r,n){var l=_.isExtensionMethod&&0===n;if(r.field&&!t.getFieldValue(r.field)){var a=t.inputList.filter(function(e){return e.name==r.field})[0];if(a.connection&&a.connection.check_){if(l&&"Array"===o(a)&&i(t,r.field))return;for(var s=0;s<a.connection.check_.length;s++)try{var u=a.connection.check_[s];b(e,t,r.field,c(u));break}catch(e){}}}})}}}catch(o){var T=o.block||t;T.setWarningText(o+""),e.errors.push(T)}}),e.bindings.forEach(function(e){null==v(e.type).type&&a(e.type,c(Ee.type))})}function y(e,t){var o=l(e),i=l(t);o.childType?a(o.childType,i):o.childType=i,i.parentType?a(i.parentType,o):i.parentType=o}function v(e,t){void 0===t&&(t=[]);var o=l(e);if(-1===t.indexOf(o)&&(t.push(o),!o.type||"Array"===o.type)){if(o.parentType){var i=v(o.parentType,t);if(i.type&&"Array"!==i.type)return o.type=i.type.substr(0,i.type.length-2),o}if(o.childType){var r=v(o.childType,t);if(r.type)return o.type=r.type+"[]",o}}return o}function _(e){var t=e.getFieldValue("math_number_minmax"===e.type?"SLIDER":"NUM"),o=parseFloat(t);return T(o,e),o}function T(e,t){(e===1/0||isNaN(e))&&n(lf("Number entered is either too large or too small"),t)}function x(e,o,i){return t.mkText(o.getFieldValue("EXPRESSION").trim())}function E(e,o,i){return t.H.mkNumberLiteral(_(o))}function B(e,o,i){var n=o.getFieldValue("OP"),l=f(o,"A"),a=f(o,"B"),s=[V(e,l,i),V(e,a,i)],c=u(e,l).type;if(c==Ae.type){if("EQ"==n)return t.H.mkSimpleCall("==",s);if("NEQ"==n)return t.H.mkSimpleCall("!=",s)}else if(c==Be.type)return t.H.mkSimpleCall(Ne[n],s);return"POWER"==n?t.H.mathCall("pow",s):(r(n in Ne),t.H.mkSimpleCall(Ne[n],s))}function A(e,o,i){var r=f(o,"DIVIDEND"),n=f(o,"DIVISOR"),l=[V(e,r,i),V(e,n,i)];return t.H.mkSimpleCall("%",l)}function C(e,o,i){var r=o.getFieldValue("op"),n=V(e,f(o,"x"),i),l=V(e,f(o,"y"),i);return t.H.mathCall(r,[n,l])}function N(e,o,i){var r=V(e,f(o,"x"),i);return t.H.mathCall("abs",[r])}function w(e,o,i){return t.H.mkStringLiteral(o.getFieldValue("TEXT"))}function I(e,o,i){for(var r,n=0;;){var l=f(o,"ADD"+n);if(n++,!l){if(n<o.inputList.length)continue;break}var a=V(e,l,i);r=r?t.H.mkSimpleCall("+",[r,a]):0===l.type.indexOf("text")?a:t.H.mkSimpleCall("+",[t.H.mkStringLiteral(""),a])}return r||t.H.mkStringLiteral("")}function S(e,o,i){return t.H.mkBooleanLiteral("TRUE"==o.getFieldValue("BOOL"))}function D(e,o,i){var r=V(e,f(o,"BOOL"),i);return t.mkPrefix("!",[t.H.mkParenthesizedExpression(r)])}function O(e,o,i){var r=o.inputList.map(function(t){return t.connection&&t.connection.targetBlock()?V(e,t.connection.targetBlock(),i):void 0}).filter(function(e){return!!e});return t.H.mkArrayLiteral(r)}function L(e,o,i){var r=V(e,f(o,"LIST"),i),n=V(e,f(o,"INDEX"),i);return t.mkGroup([r,t.mkText("["),n,t.mkText("]")])}function F(e,o,i){var r=f(o,"LIST"),n=V(e,r,i),l=V(e,f(o,"INDEX"),i),a=V(e,f(o,"VALUE"),i),s=t.mkGroup([n,t.mkText("["),l,t.mkText("] = "),a]);return"lists_create_with"===r.type?de(s):s}function R(e,o,i){var r=K(o.getFieldValue("NAME"),e,!0),n=f(o,"STACK");return[t.mkText("function "+r+"() "),ue(e,n)]}function P(e,o,i){var r=K(o.getFieldValue("NAME"),e,!0);return t.mkStmt(t.mkText(r+"()"))}function M(e){if(null==e.type&&(a(e,c(Ee.type)),e=l(e)),d(e.type))return t.mkText("[]");switch(e.type){case"boolean":return t.H.mkBooleanLiteral(!1);case"number":return t.H.mkNumberLiteral(0);case"string":return t.H.mkStringLiteral("");default:return t.mkText("null")}}function V(o,i,n){r(null!=i),o.stats[i.type]=(o.stats[i.type]||0)+1,ye(i,n);var a;if(i.disabled||"placeholder"==i.type)if("Array"===l(u(o,i)).type){var s="lists_index_get"===i.parentBlock_.type;s||(s=(p=o.stdCallTable[i.parentBlock_.type])&&p.isExpression);var c=t.mkText("[0]");a=s?c:de(c)}else a=M(u(o,i));else switch(i.type){case"math_number":case"math_number_minmax":a=E(o,i,n);break;case"math_op2":a=C(o,i,n);break;case"math_op3":a=N(o,i,n);break;case"math_arithmetic":case"logic_compare":case"logic_operation":a=B(o,i,n);break;case"math_modulo":a=A(o,i,n);break;case"logic_boolean":a=S(o,i,n);break;case"logic_negate":a=D(o,i,n);break;case"variables_get":a=J(o,i);break;case"text":a=w(o,i,n);break;case"text_join":a=I(o,i,n);break;case"lists_create_with":a=O(o,i,n);break;case"lists_index_get":a=L(o,i,n);break;case"lists_index_set":a=F(o,i,n);break;case pxtc.TS_OUTPUT_TYPE:a=x(o,i,n);break;default:var p=o.stdCallTable[i.type];p?a=p.imageLiteral?se(o,i,p.imageLiteral,p.namespace,p.f,p.args.map(function(e){return te(o,i,e,n)})):oe(o,i,p,n):(e.reportError("blocks","unabled compile expression",{details:i.type}),a=M(u(o,i)))}return a.id=i.id,a}function U(e){return e.declaredInLocalScope&&!e.mustBeGlobal}function H(e,t,o){return r(null==G(e,t)),{workspace:e.workspace,bindings:[{name:t,type:c(o),declaredInLocalScope:0}].concat(e.bindings),stdCallTable:e.stdCallTable,errors:e.errors,renames:e.renames,stats:e.stats}}function G(e,t){for(var o=0;o<e.bindings.length;++o)if(e.bindings[o].name==t)return e.bindings[o];return null}function W(e){return{workspace:e,bindings:[],stdCallTable:{},errors:[],renames:{oldToNew:{},takenNames:{},oldToNewFunctions:{}},stats:{}}}function X(e,o,r){for(var n=[],l=0;l<=o.elseifCount_;++l){var a=V(e,f(o,"IF"+l),r),s=ue(e,f(o,"DO"+l)),c=t.mkText("if (");l>0&&((c=t.mkText("else if (")).glueToBlock=t.GlueMode.WithSpace),i(n,[c,a,t.mkText(")"),s])}if(o.elseCount_){var u=t.mkText("else");u.glueToBlock=t.GlueMode.WithSpace,i(n,[u,ue(e,f(o,"ELSE"))])}return n}function q(e,o,i){var n=K(o.getFieldValue("VAR"),e),l=f(o,"TO"),a=f(o,"DO"),s=f(o,"BY"),c=f(o,"FROM"),u=!s||s.type.match(/^math_number/)&&1==_(s);return r(G(e,n).declaredInLocalScope>0),[t.mkText("for (let "+n+" = "),c?V(e,c,i):t.mkText("0"),t.mkText("; "),t.mkInfix(t.mkText(n),"<=",V(e,l,i)),t.mkText("; "),u?t.mkText(n+"++"):t.mkInfix(t.mkText(n),"+=",V(e,s,i)),t.mkText(")"),ue(e,a)]}function Y(e,o,i){for(var r=V(e,f(o,"TIMES"),i),n=ue(e,f(o,"DO")),l="i",a=0;!function(t){return!G(e,t)}(l);a++)l="i"+a;return[t.mkText("for (let "+l+" = 0; "),t.mkInfix(t.mkText(l),"<",r),t.mkText("; "+l+"++)"),n]}function j(e,o,i){var r=V(e,f(o,"COND"),i),n=ue(e,f(o,"DO"));return[t.mkText("while ("),r,t.mkText(")"),n]}function z(e,o,i){var n=K(o.getFieldValue("VAR"),e),l=f(o,"LIST"),a=f(o,"DO");return r(G(e,n).declaredInLocalScope>0),[t.mkText("for (let "+n+" of "),V(e,l,i),t.mkText(")"),ue(e,a)]}function K(e,t,o){if(void 0===o&&(o=!1),!e)return"_";if(o){if(t.renames.oldToNewFunctions[e])return t.renames.oldToNewFunctions[e]}else if(t.renames.oldToNew[e])return t.renames.oldToNew[e];var i=ts.pxtc.escapeIdentifier(e);if(t.renames.takenNames[i]){for(var r=2;t.renames.takenNames[i+r];)r++;i+=r}return o?t.renames.oldToNewFunctions[e]=i:t.renames.oldToNew[e]=i,t.renames.takenNames[i]=!0,i}function J(e,o){var i=K(o.getFieldValue("VAR"),e),n=G(e,i);return n.assigned||(n.assigned=we.Read),r(null!=n&&null!=n.type),t.mkText(i)}function Q(e,o,i){var r=K(o.getFieldValue("VAR"),e),n=f(o,"VALUE"),l=G(e,r),a=!1;l.assigned||(o.getSurroundParent()?l.assigned=we.Read:(l.assigned=we.Assign,a=!0));var s=V(e,n,i);return t.mkStmt(t.mkText(a?"let ":""),t.mkText(r+" = "),s)}function $(e,o,i){var r=K(o.getFieldValue("VAR"),e),n=f(o,"VALUE"),l=G(e,r);l.assigned||(l.assigned=we.Read);var a=V(e,n,i),s=t.mkText(r);return t.mkStmt(t.mkInfix(s,"+=",a))}function Z(e){return e.args.map(function(e){return e.field}).filter(function(e){return!!e})}function ee(e,o,i){var r=e.stdCallTable[o.type];return r.imageLiteral?t.mkStmt(se(e,o,r.imageLiteral,r.namespace,r.f,r.args.map(function(t){return te(e,o,t,i)}))):r.hasHandler?le(e,o,r,Z(r),r.namespace,i):t.mkStmt(oe(e,o,r,i))}function te(e,o,i,r,n){void 0===n&&(n=!1);var l=i.literal;if(l)return l instanceof String?t.H.mkStringLiteral(l):t.H.mkNumberLiteral(l);var a=o.getFieldValue(i.field);if(null!=a)return o.getField(i.field)instanceof pxtblockly.FieldTextInput?t.H.mkStringLiteral(a):t.mkText(a);m(e,o,i.field);var s=f(o,i.field);return n&&"lists_create_with"===s.type?de(V(e,s,r)):V(e,s,r)}function oe(e,o,i,r){var n;n=ae(o)&&o.mutation.getMutationType()===t.MutatorTypes.RestParameterMutator?o.mutation.compileMutation(e,r).children:i.args.map(function(t,n){return te(e,o,t,r,i.isExtensionMethod&&0===n&&!i.isExpression)});var l=!o.getInputsInline();if(i.isIdentity)return n[0];if(i.property)return t.H.mkPropertyAccess(i.f,n[0]);if(i.isExtensionMethod){if(i.attrs.defaultInstance){var a=void 0;ae(o)&&o.mutation.getMutationType()===t.MutatorTypes.DefaultInstanceMutator&&(a=o.mutation.compileMutation(e,r)),a?n.unshift(a):n.unshift(t.mkText(i.attrs.defaultInstance))}return t.H.extensionCall(i.f,n,l)}return i.namespace?t.H.namespaceCall(i.namespace,i.f,n,l):t.H.stdCall(i.f,n,l)}function ie(e,o,i,r,n,l,a){void 0===a&&(a=!1),n.noFinalNewline=!0;var s;return s=l?t.mkGroup([l,n]):t.mkGroup([t.mkText("function ()"),n]),a?t.mkStmt(t.H.extensionCall(i,r.concat([s]),!1)):t.mkStmt(t.H.namespaceCall(o,i,r.concat([s]),!1))}function re(e,o,i,r){var n=f(o,i);return n?V(e,n,r):o.getField(i)instanceof pxtblockly.FieldTextInput?t.H.mkStringLiteral(o.getFieldValue(i)):t.mkText(o.getFieldValue(i))}function ne(o,i){var r=ue(o,f(i,"HANDLER"));return e.appTarget.compile&&e.appTarget.compile.onStartText&&r&&r.children&&r.children.unshift(t.mkStmt(t.mkText("// "+pxtc.ON_START_COMMENT+"\n"))),r}function le(o,i,r,n,l,a){var s=n.map(function(e){return re(o,i,e,a)}),c=f(i,"HANDLER"),u=ue(o,c);e.appTarget.compile&&e.appTarget.compile.emptyEventHandlerComments&&0===u.children.length&&u.children.unshift(t.mkStmt(t.mkText("// "+pxtc.HANDLER_COMMENT)));var p;if(ae(i)&&i.mutation.getMutationType()===t.MutatorTypes.ObjectDestructuringMutator)p=i.mutation.compileMutation(o,a);else if(r.handlerArgs.length){for(var d=[],h=0;h<r.handlerArgs.length;h++){var m=r.handlerArgs[h],g=i.getFieldValue("HANDLER_"+m.name);if(null===g)break;d.push(K(g,o))}p=t.mkText("function ("+d.join(", ")+")")}return ie(o,l,r.f,s,u,p,r.isExtensionMethod)}function ae(e){return!!e.mutation}function se(e,o,i,r,n,l){l=void 0===l?[]:l;for(var a="\n",s=5*i,c=0;c<5;++c){for(var u=0;u<s;++u)u>0&&(a+=" "),a+=/TRUE/.test(o.getFieldValue("LED"+u+c))?"#":".";a+="\n"}var p=t.H.mkStringLiteral(a);return p.canIndentInside=!0,t.H.namespaceCall(r,n,[p].concat(l),!1)}function ce(o,i){var r,n=[];switch(o.stats[i.type]=(o.stats[i.type]||0)+1,ye(i,n),i.type){case"controls_if":r=X(o,i,n);break;case"controls_for":case"controls_simple_for":r=q(o,i,n);break;case"controls_for_of":r=z(o,i,n);break;case"variables_set":r=[Q(o,i,n)];break;case"variables_change":r=[$(o,i,n)];break;case"controls_repeat_ext":r=Y(o,i,n);break;case"device_while":r=j(o,i,n);break;case"procedures_defnoreturn":r=R(o,i,n);break;case"procedures_callnoreturn":r=[P(o,i,n)];break;case ts.pxtc.ON_START_TYPE:r=ne(o,i).children;break;case pxtc.TS_STATEMENT_TYPE:r=pe(o,i);break;default:r=o.stdCallTable[i.type]?[ee(o,i,n)]:[t.mkStmt(V(o,i,n))]}var l=r[r.length-1];return l&&(l.id=i.id),n.length&&ve(n,r),r.forEach(function(o){(o.type===t.NT.Block||o.type===t.NT.Prefix&&e.Util.startsWith(o.op,"//"))&&(o.id=i.id)}),r}function ue(e,o){for(var r=[];o;)o.disabled||i(r,ce(e,o)),o=o.getNextBlock();return t.mkBlock(r)}function pe(e,o){for(var i=[],r=0;;){var n=o.getFieldValue("LINE"+r);if(r++,null===n)break;i.push(t.mkText(n+"\n"));var l=o.declaredVariables;l&&l.split(",").forEach(function(t){var o=G(e,t);o?(o.assigned=we.Assign,o.mustBeGlobal=!1):e.bindings.push({name:t,type:s(null),assigned:we.Assign,declaredInLocalScope:1,mustBeGlobal:!1})})}return i}function de(e){var o=t.mkStmt(t.mkText(";"));return o.glueToBlock=t.GlueMode.NoSpace,t.mkGroup([o,e])}function he(t,o,i){function r(e,t){null==G(n,e)&&(n=H(n,e,t)),++G(n,e).declaredInLocalScope>1&&(G(n,e).mustBeGlobal=!0)}var n=W(t);if(o&&(Object.keys(o.apis.byQName).forEach(function(e){var t=o.apis.byQName[e];t.kind===pxtc.SymbolKind.Enum&&(n.renames.takenNames[t.qName]=!0)}),o.blocks.forEach(function(t){if(n.stdCallTable[t.attributes.blockId])e.reportError("blocks","function already defined",{details:t.attributes.blockId});else{n.renames.takenNames[t.namespace]=!0;var o=e.blocks.parameterNames(t),i=o.attrNames,r=o.handlerArgs,l=t.kind==pxtc.SymbolKind.Method||t.kind==pxtc.SymbolKind.Property,a=(t.parameters||[]).map(function(e){return i[e.name]&&i[e.name].name?{field:i[e.name].name}:null}).filter(function(e){return!!e});l&&!t.attributes.defaultInstance&&a.unshift({field:i.this.name}),n.stdCallTable[t.attributes.blockId]={namespace:t.namespace,f:t.name,args:a,attrs:t.attributes,handlerArgs:r,isExtensionMethod:l,isExpression:t.retType&&"void"!==t.retType,imageLiteral:t.attributes.imageLiteral,hasHandler:!!r.length||t.parameters&&t.parameters.some(function(e){return"() => void"==e.type||!!e.properties}),property:!t.parameters,isIdentity:"TD_ID"==t.attributes.shim}}})),i)return n;var l=function(e,t){if(!e)return!1;if(("controls_for"==e.type||"controls_simple_for"==e.type||"controls_for_of"==e.type)&&K(e.getFieldValue("VAR"),n)==t)return!0;if(ae(e)&&e.mutation.isDeclaredByMutation(t))return!0;var o=n.stdCallTable[e.type];if(o&&o.handlerArgs.length){var i=!1;if(o.handlerArgs.forEach(function(o){if(!i){var r=e.getFieldValue("HANDLER_"+o.name);null!=r&&K(r,n)===t&&(i=!0)}}),i)return!0}return l(e.getSurroundParent(),t)};return t&&t.getAllBlocks().filter(function(e){return!e.disabled}).forEach(function(e){if("controls_for"==e.type||"controls_simple_for"==e.type||"controls_for_of"==e.type){var t=K(e.getFieldValue("VAR"),n);"controls_for_of"==e.type?r(t,null):r(t,Ee.type)}else if(ae(e)){var o=e.mutation.getDeclaredVariables();if(o)for(var i in o)r(K(i,n),o[i])}var l=n.stdCallTable[e.type];l&&l.handlerArgs.length&&l.handlerArgs.forEach(function(t){var o=e.getFieldValue("HANDLER_"+t.name);null!=o&&r(K(o,n),t.type)})}),t&&t.getAllBlocks().filter(function(e){return!e.disabled}).forEach(function(e){if("variables_get"==e.type||"variables_set"==e.type||"variables_change"==e.type){var t=K(e.getFieldValue("VAR"),n);null==G(n,t)&&(n=H(n,t,null));var o=G(n,t);o.declaredInLocalScope&&!l(e,t)&&(o.mustBeGlobal=!0)}}),n}function me(e,t){if(e.type===ts.pxtc.ON_START_TYPE)return 0;var o=t.stdCallTable[e.type];return o&&o.attrs.afterOnStart?1:-1}function fe(e,o,r){try{k(e,o);var n=[],l=o.getTopBlocks(!0).sort(function(t,o){return me(t,e)-me(o,e)});return be(e,o.getAllBlocks(),l),l.forEach(function(o){if(o.type==ts.pxtc.ON_START_TYPE)i(n,ne(e,o).children);else{var r=ue(e,o);r.type==t.NT.Block?i(n,r.children):n.push(r)}}),e.bindings.filter(function(e){return!U(e)&&e.assigned!=we.Assign}).map(function(e){var o,i=v(e.type),n="";if("null"==(o="Array"===i.type?t.mkText("[]"):M(i)).op||"[]"==o.op){var l=i.type;"Array"!==l&&"null[]"!==l||(l="number[]");var a=r.apis.byQName[l];a&&a.attributes.autoCreate?o=t.mkText(a.attributes.autoCreate+"()"):n=": "+l}return t.mkStmt(t.mkText("let "+e.name+n+" = "),o)}).concat(n)}catch(t){var a=t.block;if(!a)throw t;a.setWarningText(t+""),e.errors.push(a)}finally{g()}return[]}function ge(e,t){if(t.type==ts.pxtc.ON_START_TYPE)return JSON.stringify({name:ts.pxtc.ON_START_TYPE});var o=e.stdCallTable[t.type];if(o){var i=Z(o).map(function(o){return re(e,t,o,[])});return JSON.stringify({name:o.f,ns:o.namespace,compiledArgs:i}).replace(/"id"\s*:\s*"[^"]+"/g,"")}}function be(e,t,o){function i(e,t){r[e]?t.setDisabled(!0):(t.setDisabled(!1),r[e]=t)}t.forEach(function(e){return e.setDisabled(!1)});var r={};o.forEach(function(t){var o=e.stdCallTable[t.type];if(t.type==ts.pxtc.ON_START_TYPE)i(ts.pxtc.ON_START_TYPE,t);else{if("procedures_defnoreturn"===t.type||o&&o.attrs.blockAllowMultiple&&!o.attrs.handlerStatement)return;if(o&&o.hasHandler&&!o.attrs.handlerStatement)i(ge(e,t),t);else for(var r=t;r;)r.setDisabled(!0),r=r.getNextBlock()}})}function ke(e,i){var r=t.flattenNode(i);return o("format",{format:{input:r.output,pos:1}}).then(function(){return{source:r.output,sourceMap:r.sourceMap,stats:e.stats}})}function ye(e,t){e.comment&&("string"==typeof e.comment?t.push(e.comment):t.push(e.comment.getText()))}function ve(e,o){for(var i=[],r=[],n=0,l=e;n<l.length;n++)for(var a=0,s=l[n].split("\n");a<s.length;a++){var c=s[a];r.push(c)}for(var u=0;u<r.length;u++){for(var p=void 0,d=0,h=r[u].split(/\s/);d<h.length;d++){var m=h[d];p?p.length+m.length>Te?(i.push(t.mkText("// "+p)),i.push(t.mkNewLine()),p=m):p+=" "+m:p=m}p&&(i.push(t.mkText("// "+p)),i.push(t.mkNewLine())),u!==r.length-1&&(i.push(t.mkText("//")),i.push(t.mkNewLine()))}for(var f=0,g=i.reverse();f<g.length;f++){var b=g[f];o.unshift(b)}}t.workerOpAsync=o;var _e={},Te=50,xe=function(){return function(e,t,o,i){this.link=e,this.type=t,this.parentType=o,this.childType=i}}();t.Point=xe;var Ee=s("number"),Be=s("boolean"),Ae=s("string"),Ce=s("void"),Ne={ADD:"+",MINUS:"-",MULTIPLY:"*",DIVIDE:"/",LT:"<",LTE:"<=",GT:">",GTE:">=",AND:"&&",OR:"||",EQ:"==",NEQ:"!="};t.compileExpression=V,function(e){e[e.Unknown=0]="Unknown",e[e.Read=1]="Read",e[e.Assign=2]="Assign"}(t.VarUsage||(t.VarUsage={}));var we=t.VarUsage;t.escapeVarName=K,t.mkEnv=he,t.compileBlockAsync=function(e,t){var o=e.workspace,i=he(o,t);k(i,o);var r=ce(i,e);return g(),ke(i,r)},t.callKey=ge,t.findBlockId=function(e,t){if(t){for(var o,i,r=0;r<e.length;++r){var n=e[r];n.start<=t.start&&n.end>t.start+t.length&&(!o||i>n.end-n.start)&&(o=n,i=n.end-n.start)}return o?o.id:void 0}},t.compileAsync=function(e,t){var o=he(e,t);return ke(o,fe(o,e,t))}}(e.blocks||(e.blocks={}))}(pxt||(pxt={}));var pxt;!function(e){!function(e){function t(e,t,i){void 0==o[e]&&(o[e]={field:t,validator:i})}var o={};e.initFieldEditors=function(){t("text",pxtblockly.FieldTextInput),t("note",pxtblockly.FieldNote,function(e){if(null===e)return null;e=String(e);var t=parseFloat(e||"0");return isNaN(t)||t<0?null:String(Math.round(Number(e)))}),t("gridpicker",pxtblockly.FieldGridPicker),t("textdropdown",pxtblockly.FieldTextDropdown),t("numberdropdown",pxtblockly.FieldNumberDropdown),t("imagedropdown",pxtblockly.FieldImageDropdown),t("colorwheel",pxtblockly.FieldColorWheel),t("toggle",pxtblockly.FieldToggle),t("toggleonoff",pxtblockly.FieldToggleOnOff),t("toggleyesno",pxtblockly.FieldToggleYesNo),t("colornumber",pxtblockly.FieldColorNumber)},e.registerFieldEditor=t,e.createFieldEditor=function(e,t,i){if(void 0==o[e])return console.error("Field editor "+e+" not registered"),null;var r=o[e];return new r.field(t,i,r.validator)}}(e.blocks||(e.blocks={}))}(pxt||(pxt={}));var pxt;!function(e){!function(t){function o(e,t){for(var o=[],i=0;i<e.childNodes.length;i++){var r=e.childNodes.item(i);r.tagName===t&&o.push(r)}return o}function i(e,t){return r(e,"block","type",t)}function r(t,o,i,r){return e.Util.toArray(t.getElementsByTagName(o)).filter(function(e){return e.getAttribute(i)===r})}function n(e,t,o,i){var n=r(e,t,o,i);return n.length?n[0]:void 0}function l(o,r){var n=i(o,ts.pxtc.ON_START_TYPE),l=n.length?n[0]:void 0;if(l)l.removeAttribute("deletable");else{var a=[],s={};r.blocks.forEach(function(e){return s[e.attributes.blockId]=e});for(var c=o.firstElementChild,u=void 0;c;){var p=c.nextElementSibling,d=c.getAttribute("type");if(!c.getAttribute("disabled")&&!c.getElementsByTagName("statement").length&&(e.blocks.buildinBlockStatements[d]||s[d]&&"void"==s[d].retType&&!t.hasArrowFunction(s[d])))if(u){var h=o.ownerDocument.createElement("next");h.appendChild(c),u.appendChild(h),c.removeAttribute("x"),c.removeAttribute("y"),u=c}else(u=o.ownerDocument.createElement("statement")).setAttribute("name","HANDLER"),l||((l=o.ownerDocument.createElement("block")).setAttribute("type",ts.pxtc.ON_START_TYPE),a.push(l)),l.appendChild(u),u.appendChild(c),c.removeAttribute("x"),c.removeAttribute("y"),u=c;c=p}a.forEach(function(e){return o.appendChild(e)})}}function a(e,o,i){var r=i.getAttribute("type"),l=Blockly.Blocks[r],a=t.blockSymbol(r);if(a&&l){var s=t.parameterNames(a).attrNames;a.parameters.forEach(function(t,r){var l=e.apis.byQName[t.type];if(l&&l.kind==pxtc.SymbolKind.Enum){var a=n(i,"field","name",s[t.name].name);if(a){var c=o[l.name+"."+a.textContent];c&&(a.textContent=c)}}})}}t.saveWorkspaceXml=function(e){var t=Blockly.Xml.workspaceToDom(e);return Blockly.Xml.domToPrettyText(t)},t.getDirectChildren=o,t.getBlocksWithType=i,t.getChildrenWithAttr=r,t.getFirstChildWithAttr=n,t.loadWorkspaceXml=function(t,o){void 0===o&&(o=!1);var i=new Blockly.Workspace;try{var r=Blockly.Xml.textToDom(t);return Blockly.Xml.domToWorkspace(r,i),i}catch(t){return o||e.reportException(t),null}},t.importXml=function(t,r,n){void 0===n&&(n=!1);try{var s=(new DOMParser).parseFromString(t,"application/xml");if(e.appTarget.compile){var c=e.appTarget.compile.upgrades||[];c.filter(function(e){return"blockId"==e.type}).forEach(function(t){return Object.keys(t.map).forEach(function(o){i(s,o).forEach(function(i){i.setAttribute("type",t.map[o]),e.debug("patched block "+o+" -> "+t.map[o])})})}),c.filter(function(e){return"blockValue"==e.type}).forEach(function(t){return Object.keys(t.map).forEach(function(r){var n=r.split("."),l=n[0];n[1],i(s,l).reduce(function(e,t){return e.concat(o(t,"value"))},[]).forEach(function(o){o.setAttribute("name",t.map[r]),e.debug("patched block value "+r+" -> "+t.map[r])})})})}var u={};for(var p in r.apis.byQName){var d=r.apis.byQName[p];d.kind==pxtc.SymbolKind.EnumMember&&(u[d.namespace+"."+(d.attributes.blockImportId||d.attributes.block||d.attributes.blockId||d.name)]=d.namespace+"."+d.name)}for(var h=s.getElementsByTagName("block"),m=0;m<h.length;++m)a(r,u,h[m]);return l(s.documentElement,r),(new XMLSerializer).serializeToString(s)}catch(o){return n||e.reportException(o),t}},t.convertColour=function(e){var t=parseInt(e);return isNaN(t)?e:Blockly.hueToRgb(t)}}(e.blocks||(e.blocks={}))}(pxt||(pxt={}));var pxt;!function(e){!function(t){!function(t){function o(t,o){var i=Blockly.Xml.workspaceToDom(t),r=Blockly.Xml.workspaceToDom(o);return e.Util.toArray(i.childNodes).filter(function(e){return e.nodeType==Node.ELEMENT_NODE&&"block"==e.localName&&"true"==e.getAttribute("disabled")}).forEach(function(e){return r.appendChild(r.ownerDocument.importNode(e,!0))}),Blockly.Xml.domToPrettyText(r)}function i(t,o,i){var r,n;o.getTopBlocks(!1).filter(function(e){return!e.disabled}).forEach(function(l){var a=l.xy_;if(a&&0!=a.x&&0!=a.y){r||(r=e.blocks.mkEnv(o,t,!0),n={},i.getTopBlocks(!1).forEach(function(t){var o=e.blocks.callKey(r,t),i=n[o]||[];i.push(t),n[o]=i}));var s=e.blocks.callKey(r,l),c=(n[s]||[]).shift();c&&(c.xy_=a.clone())}})}function r(e){return l(e).then(function(e){return e?n(e.width,e.height,4,e.xml):Promise.resolve(void 0)})}function n(t,o,i,r){return new Promise(function(n,l){var a=document.createElement("canvas"),s=a.getContext("2d"),c=new Image;a.width=t*i,a.height=o*i,c.onload=function(){s.drawImage(c,0,0,t,o,0,0,a.width,a.height);var e=a.toDataURL("image/png");n(e)},c.onerror=function(t){e.reportError("blocks","blocks screenshot failed"),n(void 0)},c.src=r})}function l(e){if(!e)return Promise.resolve(void 0);var t=document.getElementsByClassName("blocklyBlockCanvas")[0].getBBox();return a(e.svgBlockCanvas_.cloneNode(!0),t.x,t.y,t.width,t.height)}function a(t,o,i,r,n){if(!t.childNodes[0])return Promise.resolve(void 0);t.removeAttribute("width"),t.removeAttribute("height"),t.removeAttribute("transform");var l=(new DOMParser).parseFromString('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="'+p+'" width="'+r+'" height="'+n+'" viewBox="'+o+" "+i+" "+r+" "+n+'">\n            '+(new XMLSerializer).serializeToString(t)+"\n            </svg>","image/svg+xml"),a=l.createElementNS("http://www.w3.org/1999/xhtml","style"),u=document.getElementById("blocklycss").href;return e.BrowserUtils.loadAjaxAsync(u).then(function(t){var o=e.Util.toArray(document.head.querySelectorAll("style")).filter(function(e){return/\.blocklySvg/.test(e.innerText)})[0];return a.appendChild(l.createCDATASection((o?o.innerText:"")+"\n\n"+t+"\n\n")),l.documentElement.insertBefore(a,l.documentElement.firstElementChild),c(l).then(function(){return{width:r,height:n,svg:(new XMLSerializer).serializeToString(l),xml:s(l)}})})}function s(e){var t=(new XMLSerializer).serializeToString(e);return"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(t)))}function c(t){d||(d={});var o=t.getElementsByTagName("image"),i=e.Util.toArray(o).filter(function(e){return!/^data:/.test(e.getAttributeNS(p,"href"))}).map(function(t){var o=t.getAttributeNS(p,"href"),i=d[o];return(i?Promise.resolve(d[o]):e.BrowserUtils.loadImageAsync(t.getAttributeNS(p,"href")).then(function(e){var t=document.createElement("canvas"),r=t.getContext("2d");return t.width=e.width,t.height=e.height,r.drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),d[o]=i=t.toDataURL("image/png"),i}).catch(function(t){e.debug("svg render: failed to load "+o)})).then(function(e){t.setAttributeNS(p,"href",e)})});return Promise.all(i).then(function(){})}function u(e,t,o){void 0===t&&(t=1.62);var i;if(o>20)i=o-20;else{for(var r=0,n=0,l=e;n<l.length;n++)r+=(m=(d=l[n]).getHeightWidth()).width*m.height;i=Math.sqrt(r)*t}for(var a=20,s=20,c=0,u=0,p=e;u<p.length;u++){var d=p[u],h=d.getBoundingRectangle(),m=d.getHeightWidth();d.moveBy(a-h.topLeft.x,s-h.topLeft.y),a+=m.width+16,c=Math.max(c,s+m.height+16),a>i&&(a=20,s=c)}}t.patchBlocksFromOldWorkspace=function(t,r,n){var l=e.blocks.loadWorkspaceXml(n,!0);return i(t,r,l),o(r,l)},t.verticalAlign=function(e,t){var o=0;e.getTopBlocks(!0).forEach(function(e){e.moveBy(0,o),o+=e.getHeightWidth().height,o+=t})},t.flow=function(e,t){if(t){if(t.useViewWidth){var o=e.getMetrics();if(o.viewHeight>o.viewWidth)return void u(e.getTopBlocks(!0),void 0,o.viewWidth)}u(e.getTopBlocks(!0),t.ratio)}else u(e.getTopBlocks(!0))},t.screenshotEnabled=function(){return!e.BrowserUtils.isIE()&&!e.BrowserUtils.isUwpEdge()},t.screenshotAsync=function(e){return r(e)},t.toPngAsync=r,t.svgToPngAsync=function(e,t,o,i,r,l){return a(e,t,o,i,r).then(function(e){return e?n(e.width,e.height,l,e.xml):Promise.resolve(void 0)})};var p="http://www.w3.org/1999/xlink";t.toSvgAsync=l,t.blocklyToSvgAsync=a,t.documentToSvg=s;var d}(t.layout||(t.layout={}))}(e.blocks||(e.blocks={}))}(pxt||(pxt={}));var Util=pxt.Util,lf=Util.lf,pxt;!function(e){!function(t){function o(){return e.Util.lf("{id:category}Advanced")}function i(){return e.Util.lf("{id:category}Extensions")}function r(e,t,o,i){if(o&&'"'==o.slice(0,1)&&(o=JSON.parse(o)),"number"==t&&"value"==i)return(u=document.createElement("field")).setAttribute("name",e),u.appendChild(document.createTextNode("0")),u;var r="variables_get"==i,n=document.createElement("value");n.setAttribute("name",e);var l=document.createElement(r?"block":"shadow");n.appendChild(l);var a=J[t];if(l.setAttribute("type",i||a&&a.block||t),l.setAttribute("colour",Blockly.Colours.textField),a){u=document.createElement("field");l.appendChild(u);var s=void 0;switch(i){case"variables_get":s="VAR";break;case"math_number_minmax":s="SLIDER";break;default:s=a.field}u.setAttribute("name",s);var c;c="boolean"==t?document.createTextNode((o||a.defaultValue).toUpperCase()):document.createTextNode(o||a.defaultValue),u.appendChild(c)}else if(r&&o){var u=document.createElement("field");l.appendChild(u),u.setAttribute("name","VAR"),u.textContent=o}return n}function n(t,o,i){var n=i.attrNames,l=i.handlerArgs,a=document.createElement("block");if(a.setAttribute("type",o.attributes.blockId),o.attributes.blockGap?a.setAttribute("gap",o.attributes.blockGap):e.appTarget.appTheme&&e.appTarget.appTheme.defaultBlockGap&&a.setAttribute("gap",e.appTarget.appTheme.defaultBlockGap.toString()),(o.kind==pxtc.SymbolKind.Method||o.kind==pxtc.SymbolKind.Property)&&n.this){var s=n.this;a.appendChild(r(s.name,s.type,s.shadowValue||s.name,s.shadowType||"variables_get"))}return o.parameters&&(o.parameters.filter(function(e){return!!n[e.name].name&&(/^(string|number|boolean)$/.test(n[e.name].type)||!!n[e.name].shadowType||!!n[e.name].shadowValue)}).forEach(function(e){var t,o,i=n[e.name];e.options&&e.options.min&&e.options.max?(t=r(i.name,i.type,i.shadowValue,"math_number_minmax"),(o=document.createElement("mutation")).setAttribute("min",e.options.min.value),o.setAttribute("max",e.options.max.value),o.setAttribute("label",e.name.charAt(0).toUpperCase()+e.name.slice(1)),e.options.fieldEditorOptions&&(e.options.fieldEditorOptions.value.step&&o.setAttribute("step",e.options.fieldEditorOptions.value.step),e.options.fieldEditorOptions.value.color&&o.setAttribute("color",e.options.fieldEditorOptions.value.color))):t=r(i.name,i.type,i.shadowValue,i.shadowType),e.options&&e.options.fieldEditorOptions&&(o||(o=document.createElement("mutation")),o.setAttribute("customfield",JSON.stringify(e.options.fieldEditorOptions.value))),t&&o&&t.firstChild.appendChild(o),a.appendChild(t)}),l.forEach(function(e){var t=document.createElement("field");t.setAttribute("name","HANDLER_"+e.name),t.textContent=e.name,a.appendChild(t)})),ie[o.attributes.blockId]=a.cloneNode(!0),a}function l(e,t,o,i,r){var n=document.createElement("category");return n.setAttribute("name",e),n.setAttribute("nameid",t.toLowerCase()),n.setAttribute("weight",o.toString()),i&&n.setAttribute("colour",i),r&&(n.setAttribute("iconclass",r),n.setAttribute("expandedclass",r)),n}function a(o,i,r,n,a,p){if(void 0===a&&(a=K.Basic),!r.attributes.blockHidden&&!r.attributes.deprecated){var g=(r.attributes.blockNamespace||r.namespace).split(".")[0],b=i.apis.byQName[g],k=b&&b.attributes.advanced;b&&(g=b.attributes.block||g);var y=ts.pxtc.blocksCategory(r);b&&b.name&&(y=e.Util.capitalize(b.name));var v=A(o,y);if(a===K.All||a==K.Basic&&!k){if(!v){d(o);e.debug("toolbox: adding category "+g);var _=(b?b.attributes.weight:50)||50,T=e.Util.capitalize((b?b.attributes.block:"")||y);if(v=l(T,y,_),b&&b.attributes.color?v.setAttribute("colour",b.attributes.color):H(g)&&v.setAttribute("colour",H(g)),b&&b.attributes.icon){var x=("blocklyTreeIcon"+b.name.toLowerCase()).replace(/\s/g,"");c(x,b.attributes.icon),v.setAttribute("iconclass",x),v.setAttribute("expandedclass",x),v.setAttribute("web-icon",b.attributes.icon)}else v.setAttribute("iconclass","blocklyTreeIconDefault"),v.setAttribute("expandedclass","blocklyTreeIconDefault"),v.setAttribute("web-icon","ï„®");b&&b.attributes.groups&&v.setAttribute("groups",b.attributes.groups.join(", ")),b&&b.attributes.labelLineWidth&&v.setAttribute("labellinewidth",b.attributes.labelLineWidth),h(v,o,_,k)}if(r.attributes.advanced)v=m(v,lf("More"),"More",1,v.getAttribute("colour"),"blocklyTreeIconmore");else if(r.attributes.subcategory){var E=r.attributes.subcategory,B=b.attributes.subcategories;if(B&&-1!==B.indexOf(E)){var C=1e4-B.indexOf(E);v=m(v,E,E,C,v.getAttribute("colour"),"blocklyTreeIconmore")}else v=f(v,E,E,v.getAttribute("colour"),"blocklyTreeIconmore");b&&b.attributes.groups&&v.setAttribute("groups",b.attributes.groups.join(", "))}}if(a===K.Basic&&k){var N=n.getAttribute("type");Z[N]=!0}if(r.attributes.optionalVariableArgs&&r.attributes.toolboxVariableArgs){var w=p.handlerArgs;(I=r.attributes.toolboxVariableArgs.split(";").map(function(e){return parseInt(e)}).filter(function(e){return e<=w.length&&e>=0})).forEach(function(e){var t=n.cloneNode(!0),i=document.createElement("mutation");i.setAttribute("numargs",e.toString());for(var l=0;l<e;l++)i.setAttribute("arg"+l,w[l].name);t.appendChild(i),a!==K.None?s(t,v,r.attributes.weight):o.appendChild(t)})}else if(r.attributes.mutateDefaults){var I=r.attributes.mutateDefaults.split(";");I.forEach(function(e){var i=n.cloneNode(!0);t.mutateToolboxBlock(i,r.attributes.mutate,e),a!==K.None?s(i,v,r.attributes.weight):o.appendChild(i)})}else a===K.None||a===K.Basic&&k?a===K.None&&o.appendChild(n):(s(n,v,r.attributes.weight,r.attributes.group),u())}}function s(e,o,i,r){var n=!!t.blockColors[o.getAttribute("nameid")];if(r&&e.setAttribute("group",r),n&&i>50){e.setAttribute("loaded","true");for(var l=void 0,a=0;a<o.childNodes.length;a++){var s=o.childNodes.item(a);if("block"===s.tagName&&!s.getAttribute("loaded")){l=s;break}}l?o.insertBefore(e,l):o.appendChild(e)}else o.appendChild(e)}function c(t,o){if(!(ne.indexOf(t)>-1))if(1===o.length){var i=e.Util.unicodeToChar(o);ne+="\n                .blocklyTreeIcon."+t+'::before {\n                    content: "'+i+'";\n                }\n            '}else ne+="\n                .blocklyTreeIcon."+t+' {\n                    background-image: url("'+e.Util.pathJoin(e.webConfig.commitCdnUrl,encodeURI(o))+'")!important;\n                    width: 30px;\n                    height: 100%;\n                    background-size: 20px !important;\n                    background-repeat: no-repeat !important;\n                    background-position: 50% 50% !important;\n                }\n            '}function u(){re||((re=document.createElement("style")).id="blocklyToolboxIcons",re.type="text/css",(document.head||document.getElementsByTagName("head")[0]).appendChild(re)),re.sheet?re.textContent=ne+le:re.appendChild(document.createTextNode(ne+le))}function p(e,t){var o=e.toLowerCase();t=t||"#dddddd",le.indexOf(o)>-1||(le+="\n            span.docs."+o+" {\n                background-color: "+t+" !important;\n                border-color: "+Blockly.PXTUtils.fadeColour(t,.2,!0)+" !important;\n            }\n        ")}function d(e){for(var t=e.getElementsByTagName("category"),o=[],i=0;i<t.length;i++)t[i].parentNode===e&&o.push(t[i]);return o}function h(e,t,o,i){var r=d(t);i&&e.setAttribute("advanced","true");var n=0;for(n=0;n<r.length;++n){var l=r[n],a=l.hasAttribute("advanced")&&"false"!==l.getAttribute("advanced");if(i){if(!a)continue}else if(a){t.insertBefore(e,l);break}if(parseInt(l.getAttribute("weight")||"50")<o){t.insertBefore(e,l);break}}n==r.length&&t.appendChild(e)}function m(e,o,i,r,n,a){var s=t.getFirstChildWithAttr(e,"category","nameid",i.toLowerCase());if(s)return s;var c=l(o,i,r,n,a),u=e.getElementsByTagName("category"),p=0;for(p=0;p<u.length;++p){var d=u[p];if(parseInt(d.getAttribute("weight")||"50")<r){e.insertBefore(c,d);break}}return p==u.length&&e.appendChild(c),c}function f(e,o,i,r,n){var a=t.getFirstChildWithAttr(e,"category","nameid",i.toLowerCase());if(a)return a;var s=l(o,i,100,r,n),c=e.getElementsByTagName("category"),u=[],p=0,d=!1,h=void 0;for(p=0;p<c.length;++p){var m=c[p],f=parseInt(m.getAttribute("weight")||"50");if(!(f>=1e3)){if(1===f){h=m;break}u.push(m),!d&&m.getAttribute("name").localeCompare(o)>=0&&(e.insertBefore(s,m),u.splice(u.length-1,0,s),d=!0)}}return d||(u.push(s),h?e.insertBefore(s,h):e.appendChild(s)),u.forEach(function(e,t){e.setAttribute("weight",(200-t).toString())}),s}function g(t,o,i,r){var n=o.attributes.blockId;if(te[n])return e.reportError("blocks","trying to override builtin block",{details:n}),!1;var l=JSON.stringify(o);if(oe[n]&&oe[n].hash==l)return!0;if(Blockly.Blocks[o.attributes.blockId])return console.error("duplicate block definition: "+n),!1;var a={hash:l,fn:o,block:{codeCard:y(o,r),init:function(){_(this,t,o,i)}}};return oe[n]=a,Blockly.Blocks[n]=a.block,!0}function b(e,t,o,i,r,n,l,a){if(r&&r.indexOf("`")>-1)for(var s=/([^`]+|(`([^`]+)`))/gi,c=void 0;c=s.exec(r);){var u=void 0;c[3]&&(u=j(c[3]))?e.appendField(u):e.appendField(c[1])}else r&&e.appendField(r);return n&&e.setAlign(Blockly.ALIGN_LEFT),l&&"T"!=l&&(Q.test(l)?e.setCheck("Array"):e.setCheck(l)),e}function k(e){return e.outerHTML.replace(/^<\?[^>]*>/,"")}function y(e,t){return{name:e.namespace+"."+e.name,shortName:e.name,description:e.attributes.jsDoc,url:e.attributes.help?"reference/"+e.attributes.help.replace(/^\//,""):void 0,blocksXml:'<xml xmlns="http://www.w3.org/1999/xhtml">'+k(t)+"</xml>"}}function v(e,t,o){if(t==o)return!0;var i=e.byQName[t];return!(!i||!i.extendsTypes)&&i.extendsTypes.indexOf(o)>=0}function _(o,i,r,n){var l=this,a=n.attrNames,s=n.handlerArgs,c=(r.attributes.blockNamespace||r.namespace).split(".")[0],u=r.kind==pxtc.SymbolKind.Method||r.kind==pxtc.SymbolKind.Property,p=i.apis.byQName[c],d=r.attributes.color||(p?p.attributes.color:void 0)||H(c.toLowerCase())||255;if(r.attributes.help)o.setHelpUrl("/reference/"+r.attributes.help.replace(/^\//,""));else if(r.pkg&&!e.appTarget.bundledpkgs[r.pkg]){var h=r.qName.toLowerCase().split(".");h[0]==r.pkg&&h.shift(),o.setHelpUrl("/pkg/"+r.pkg+"#"+encodeURIComponent(h.join("-")))}o.setTooltip(r.attributes.jsDoc),o.setColour(d,r.attributes.colorSecondary,r.attributes.colorTertiary);var m=Blockly.OUTPUT_SHAPE_ROUND;"boolean"==r.retType&&(m=Blockly.OUTPUT_SHAPE_HEXAGONAL),o.setOutputShape(m),r.attributes.undeletable&&o.setDeletable(!1),t.parseFields(r.attributes.block).map(function(n){var l;if(n.p){var s=n.pre,c=n.p,h=Object.keys(a).filter(function(e){return a[e].name==c})[0];if(!h)return void console.error("block "+r.attributes.blockId+": unkown parameter "+c);var m=a[h],f=e.U.lookup(i.apis.byQName,m.type),g=f&&f.kind==pxtc.SymbolKind.Enum,k=f&&!!f.attributes.fixedInstances&&!m.shadowType,y=r.attributes.paramFieldEditor&&r.attributes.paramFieldEditor[c],_=m.name.charAt(0).toUpperCase()+m.name.slice(1),T=m.type;if(g||k){var x=e.Util.values(i.apis.byQName).filter(function(e){return g?e.namespace==m.type:e.kind==pxtc.SymbolKind.Variable&&e.attributes.fixedInstance&&v(i.apis,e.retType,f.qName)});0==x.length&&console.error("no instances of "+f.qName+" found");var E=x.map(function(t){var o=t.attributes.block||t.attributes.blockId||t.name;return[t.attributes.iconURL||t.attributes.blockImage?{src:t.attributes.iconURL||e.Util.pathJoin(e.webConfig.commitCdnUrl,"blocks/"+t.namespace.toLowerCase()+"/"+t.name.toLowerCase()+".png"),alt:o,width:36,height:36,value:t.name}:o,t.namespace+"."+t.name]});if(l=b(o.appendDummyInput(),n.ni,r,p,s,!0),m.shadowValue){var B=-1;if(E.some(function(e,t){return e[1]===m.shadowValue&&(B=t,!0)}),B>-1){var A=E.splice(B,1)[0];E.unshift(A)}}if(y){var C=r.attributes.paramDefl[m.name]||"",N={data:E,colour:d,label:_,type:T};e.Util.jsonMergeFrom(N,r.attributes.paramFieldEditorOptions&&r.attributes.paramFieldEditorOptions[m.name]||{}),l.appendField(t.createFieldEditor(y,C,N),a[h].name)}else l.appendField(new Blockly.FieldDropdown(E),a[h].name)}else if(y){l=b(o.appendDummyInput(),n.ni,r,p,s,!0);var C=r.attributes.paramDefl[m.name]||"",w={colour:d,label:_,type:T};e.Util.jsonMergeFrom(w,r.attributes.paramFieldEditorOptions&&r.attributes.paramFieldEditorOptions[m.name]||{}),l.appendField(t.createFieldEditor(y,C,w),a[h].name)}else u&&"this"==h?r.attributes.defaultInstance||(l=b(o.appendValueInput(c),n.ni,r,p,s,!0,m.type)):"number"==m.type?m.shadowType&&"value"==m.shadowType?(l=o.appendDummyInput(),s&&l.appendField(s),l.appendField(new Blockly.FieldTextInput("0",Blockly.FieldTextInput.numberValidator),c)):l=b(o.appendValueInput(c),n.ni,r,p,s,!0,"Number"):l="boolean"==m.type?b(o.appendValueInput(c),n.ni,r,p,s,!0,"Boolean"):"string"==m.type?b(o.appendValueInput(c),n.ni,r,p,s,!0,"String"):b(o.appendValueInput(c),n.ni,r,p,s,!0,m.type)}else l=b(o.appendDummyInput(),n.ni,r,p,n.n)});var f=!1;if(s.length)if(f=!0,r.attributes.optionalVariableArgs)E(o,s);else{var g=o.appendDummyInput();s.forEach(function(e){g.appendField(new Blockly.FieldVariable(e.name),"HANDLER_"+e.name)})}r.attributes.mutate?t.addMutation(o,r,r.attributes.mutate):r.attributes.defaultInstance&&t.addMutation(o,r,t.MutatorTypes.DefaultInstanceMutator);var k=o.mutationToDom,y=o.domToMutation;if(o.mutationToDom=function(){var e=k?k.call(l):document.createElement("mutation");return o.inputList.forEach(function(t){t.fieldRow.forEach(function(t){if(t.isFieldCustom_&&t.saveOptions){var o=t.saveOptions();e.setAttribute("customfield",JSON.stringify(o))}})}),e},o.domToMutation=function(e){y&&y.call(l,e),o.inputList.forEach(function(t){t.fieldRow.forEach(function(t){if(t.isFieldCustom_&&t.restoreOptions){var o=JSON.parse(e.getAttribute("customfield"));t.restoreOptions(o)}})})},r.attributes.imageLiteral)for(var _=0;_<5;++_)for(var x=o.appendDummyInput(),B=0;B<5*r.attributes.imageLiteral;++B)B>0&&B%5==0?x.appendField("  "):B>0&&x.appendField(" "),x.appendField(new Blockly.FieldCheckbox("FALSE"),"LED"+B+_);switch("external"===r.attributes.inlineInputMode?o.setInputsInline(!1):"inline"===r.attributes.inlineInputMode?o.setInputsInline(!0):o.setInputsInline(r.parameters.length<4&&!r.attributes.imageLiteral),((r.parameters?r.parameters.filter(function(e){return"() => void"==e.type})[0]:void 0)||f)&&(o.appendStatementInput("HANDLER").setCheck("null"),o.setInputsInline(!0)),r.retType){case"number":o.setOutput(!0,"Number");break;case"string":o.setOutput(!0,"String");break;case"boolean":o.setOutput(!0,"Boolean");break;case"void":break;default:Q.test(r.retType)?o.setOutput(!0,"Array"):o.setOutput(!0,"T"!==r.retType?r.retType:void 0)}var A=T(r);o.setPreviousStatement(!(A&&!r.attributes.handlerStatement)&&"void"==r.retType),o.setNextStatement(!(A&&!r.attributes.handlerStatement)&&"void"==r.retType),o.setTooltip(r.attributes.jsDoc)}function T(e){return!!(e.parameters?e.parameters.filter(function(e){return/^\([^\)]*\)\s*=>/.test(e.type)})[0]:void 0)}function x(e,t){var o=A(e,t);o&&o.parentNode&&o.parentNode.removeChild(o)}function E(t,o){function i(){l.appendField(new Blockly.FieldImage(t.ADD_IMAGE_DATAURI,24,24,!1,lf("Add argument"),function(){r=Math.min(r+1,o.length),a()}),"_HANDLER_ADD")}e.U.assert(!t.domToMutation),e.U.assert(!t.mutationToDom);var r=0,n=0,l=t.appendDummyInput(),a=function(){if(r!==n){if(r>n)for(var e=r-n,t=0;t<e;t++){a=o[n+t];l.insertFieldAt(l.fieldRow.length-1,new Blockly.FieldVariable(a.name),"HANDLER_"+a.name)}else for(var e=n-r,t=0;t<e;t++){var a=o[n-t-1];l.removeField("HANDLER_"+a.name)}r>=o.length?l.removeField("_HANDLER_ADD"):n>=o.length&&i(),n=r}};Blockly.Extensions.apply("inline-svgs",t,!1),i(),t.domToMutation=function(e){var i=parseInt(e.getAttribute("numargs"));r=Math.min(isNaN(i)?0:i,o.length),a();for(var n=0;n<r;n++){var l=e.getAttribute("arg"+n);t.setFieldValue(l,"HANDLER_"+o[n].name)}},t.mutationToDom=function(){var e=document.createElement("mutation");e.setAttribute("numArgs",r.toString());for(var i=0;i<r;i++){var n=t.getFieldValue("HANDLER_"+o[i].name);e.setAttribute("arg"+i,n)}return e}}function B(r,c,f,b,k){function y(e,t){for(var o=!1,i=0;i<e.length;++i){var r=e.item(i),n=r.getAttribute("type");switch(b.blocks&&void 0!=b.blocks[n]?b.blocks[n]:void 0!=t?t:b.defaultState){case ae.Hidden:r.parentNode.removeChild(r),--i;break;case ae.Disabled:r.setAttribute("disabled","true");break;case ae.Visible:o=!0}}return o}function v(e,t){if(t)x(_,e);else{var o=A(_,e);if(o){var i=o.getAttribute("advanced");if(i&&"false"!==i){E=!0;for(var r=o.getElementsByTagName("block"),n=0;n<r.length;n++){var l=r.item(n);Z[l.getAttribute("type")]=!0}f===K.Basic&&x(_,e)}}}}void 0===f&&(f=K.Basic),N();var _=c?c.cloneNode(!0):void 0;r.blocks.sort(function(e,t){var o=r.apis.byQName[e.attributes.blockNamespace||e.namespace.split(".")[0]],i=r.apis.byQName[t.attributes.blockNamespace||t.namespace.split(".")[0]];if(o&&!i)return-1;if(i&&!o)return 1;var n=0;return o&&i&&0!=(n=(i.attributes.weight||50)-(o.attributes.weight||50))?n:n=(t.attributes.weight||50)-(e.attributes.weight||50)}),ie={},Z={};var T={},E=!1,B=e.options.debug;if(r.blocks.filter(function(e){return!_||!t.getFirstChildWithAttr(_,"block","type",e.attributes.blockId)}).forEach(function(o){if(o.attributes.blockBuiltin)e.Util.assert(!!te[o.attributes.blockId]),te[o.attributes.blockId].symbol=o;else{var i=t.parameterNames(o),l=n(r,o,i);if(g(r,o,i,l)&&(!_||o.attributes.debug&&!B||a(_,r,o,l,f,i),T[o.attributes.blockId]=1,!E&&!o.attributes.blockHidden&&!o.attributes.deprecated)){var s=(o.attributes.blockNamespace||o.namespace).split(".")[0],c=r.apis.byQName[s];E=E||c&&c.attributes.advanced}}}),Object.keys(oe).filter(function(e){return!T[e]}).forEach(function(e){return C(oe[e].fn)}),_&&e.appTarget.runtime){var w=e.appTarget.runtime.extraBlocks||[];w.push({namespace:e.appTarget.runtime.onStartNamespace||"loops",weight:e.appTarget.runtime.onStartWeight||10,type:ts.pxtc.ON_START_TYPE}),w.forEach(function(e){var t=document.createElement("block");if(t.setAttribute("type",e.type),t.setAttribute("weight",(e.weight||50).toString()),e.gap&&t.setAttribute("gap",e.gap.toString()),e.fields)for(var o in e.fields){var i=document.createElement("field");i.setAttribute("name",o),i.appendChild(document.createTextNode(e.fields[o])),t.appendChild(i)}if(f!==K.None){var r=A(_,e.namespace);r?s(t,r,e.weight):console.error("trying to add block "+e.type+" to unknown category "+e.namespace)}else _.appendChild(t)})}if(_&&k&&k.length>0&&k.forEach(function(t){var o=t.name,i=t.extension.color||"#7f8c8d",r=t.extension.label?e.Util.rlf(t.extension.label):e.Util.lf("Editor"),n=goog.dom.createDom("button");n.setAttribute("text",r),n.setAttribute("callbackkey","EXT"+o+"_BUTTON");var a=t.extension.namespace||o,s=t.extension.advanced||!1,c=function(e,t){for(var o,i=0;i<t.childNodes.length;i++){var r=t.childNodes.item(i);if("block"===r.tagName){o=r;break}}o?t.insertBefore(e,o):t.appendChild(e)};if(f!==K.None){if(f===K.All||f==K.Basic&&!s){var u=A(_,a);if(u)c(n,u);else{var p=l(e.Util.rlf("{id:category}"+o),o,55,i,"blocklyTreeIconextensions");h(p,_,55,!1),c(n,p)}}}else _.appendChild(n)}),_&&f!==K.None){var I=e.appTarget.runtime||{};v("Math",!I.mathBlocks),v("Variables",!I.variablesBlocks),v("Logic",!I.logicBlocks),v("Loops",!I.loopsBlocks),v("Text",!I.textBlocks),v("Arrays",!I.listsBlocks),v("Functions",!I.functionBlocks),!I.listsBlocks&&I.loopsBlocks&&(G=A(_,"Loops"))&&G.removeChild(t.getFirstChildWithAttr(G,"block","type","controls_for_of"));for(var S=_.getElementsByTagName("category"),D=0;D<S.length;D++)S[D].setAttribute("name",e.Util.rlf("{id:category}"+S[D].getAttribute("name"),[])),p(S[D].getAttribute("name"),S[D].getAttribute("colour"));for(var O=t.getDirectChildren(_,"category"),D=0;D<O.length;D++){var L=H(O[D].getAttribute("nameid"));if(L&&""!=L){O[D].setAttribute("colour",L);for(var F=d(O[D]),R=0;R<F.length;R++)F[R].setAttribute("colour",L)}if(!e.appTarget.appTheme.hideFlyoutHeadings){var P=goog.dom.createDom("label");P.setAttribute("text",O[D].getAttribute("name")),P.setAttribute("web-class","blocklyFlyoutHeading"),P.setAttribute("web-icon-color",O[D].getAttribute("colour"));var M=O[D].getAttribute("web-icon"),V=O[D].getAttribute("web-icon-class");M&&(1===M.length?(P.setAttribute("web-icon",M),V&&P.setAttribute("web-icon-class",V)):(ne+="\n                                .blocklyFlyoutLabelIcon.blocklyFlyoutIcon"+O[D].getAttribute("name")+' {\n                                    display: inline-block !important;\n                                    background-image: url("'+e.Util.pathJoin(e.webConfig.commitCdnUrl,encodeURI(M))+'")!important;\n                                    width: 1em;\n                                    height: 1em;\n                                    background-size: 1em!important;\n                                }\n                            ',u(),P.setAttribute("web-icon-class","blocklyFlyoutIcon"+O[D].getAttribute("name")))),O[D].insertBefore(P,O[D].firstChild);for(var F=d(O[D]),R=0;R<F.length;R++){var U=goog.dom.createDom("label");U.setAttribute("text",O[D].getAttribute("name")+" > "+F[R].getAttribute("name")),U.setAttribute("web-class","blocklyFlyoutHeading"),U.setAttribute("web-icon-color",O[D].getAttribute("colour")),F[R].insertBefore(U,F[R].firstChild),M&&(1==M.length?(U.setAttribute("web-icon",M),V&&U.setAttribute("web-icon-class",V)):U.setAttribute("web-icon-class","blocklyFlyoutIcon"+O[D].getAttribute("name")))}}}}if(_&&$(_).find("shadow:empty").each(function(e,t){var o=t.getAttribute("type"),i=$(_).find('block[type="'+o+'"]')[0];i&&(t.innerHTML=i.innerHTML)}),E&&_&&f!==K.None){var G=l(o(),"Advanced",1,H("advanced"),f===K.Basic?"blocklyTreeIconadvancedcollapsed":"blocklyTreeIconadvancedexpanded");h(document.createElement("sep"),_,1.5,!1),h(G,_,1,!1)}if(_&&(!E||f===K.All)&&e.appTarget.cloud&&e.appTarget.cloud.packages&&(E||h(document.createElement("sep"),_,1.5,!1),m(_,i(),"Extensions",1,"#717171","blocklyTreeIconaddpackage")),_){for(var W=_.getElementsByTagName("block"),D=0;D<W.length;D++)Z[W.item(D).getAttribute("type")]=!0;ee=!0}if(_&&b){if(f!==K.None){for(var X=_.getElementsByTagName("category"),q=0;q<X.length;++q)if("more"!==(le=(G=X.item(q)).getAttribute("nameid"))&&"advanced"!==le&&("variables"!==le||b.blocks&&!b.blocks.variables_set&&!b.blocks.variables_get&&!b.blocks.variables_change||b.namespaces&&b.namespaces.variables===ae.Disabled)){var Y=b.namespaces&&void 0!=b.namespaces[le]?b.namespaces[le]:b.defaultState,j=G.getElementsByTagName("block"),z="variables"==le&&b.blocks?b.blocks.variables_get||b.blocks.variables_set:y(j,Y);switch(Y){case ae.Disabled:if(!z){G.setAttribute("disabled","true");for(var J=G.getElementsByTagName("category"),Q=0;Q<J.length;++Q)J.item(Q).setAttribute("disabled","true")}break;case ae.Visible:case ae.Hidden:z||(G.parentNode.removeChild(G),--q)}}for(q=0;q<X.length;++q)if("advanced"==(le=(G=X.item(q)).getAttribute("nameid"))&&0==G.childNodes.length){G.parentNode.removeChild(G),--q;var re=_.getElementsByTagName("sep")[0];re.parentNode.removeChild(re)}}else y(_.getElementsByTagName("block"));if(f!==K.None)for(var X=_.getElementsByTagName("category"),q=0;q<X.length;++q){var le=(G=X.item(q)).getAttribute("nameid");"variables"!=le&&"functions"!=le&&"advanced"!=le&&(0==G.getElementsByTagName("block").length&&G.parentNode&&G.parentNode.removeChild(G))}}if(_)for(var X=_.getElementsByTagName("category"),q=0;q<X.length;++q){(function(o){var i=X.item(o);if("advanced"===i.getAttribute("nameid"))return"continue";var r=t.getDirectChildren(i,"block"),n=i.getAttribute("groups"),l=i.getAttribute("labellinewidth"),a={},s=[];n&&(s=n.split(", "));for(var c=0;c<r.length;++c){var u=r[c];a[h=u.getAttribute("group")||"other"]||(a[h]=[]),a[h].push(u)}if(Object.keys(a).length>1){Object.keys(a).sort().forEach(function(e){-1==s.indexOf(e)&&s.push(e)});for(var p=[],d=0;d<s.length;++d){var h=s[d];if(a[h]&&a[h].length){if("other"!=h){var m=goog.dom.createDom("label");m.setAttribute("text",e.Util.rlf("{id:group}"+h)),m.setAttribute("web-class","blocklyFlyoutGroup"),m.setAttribute("web-line","1.5"),l&&m.setAttribute("web-line-width",l),p.push(m)}a[h]&&a[h].forEach(function(e){i.removeChild(e),p.push(e)})}}p.forEach(function(e){i.appendChild(e)})}})(q)}return _}function A(e,o){return e?t.getFirstChildWithAttr(e,"category","nameid",o.toLowerCase()):void 0}function C(e){delete Blockly.Blocks[e.attributes.blockId],delete oe[e.attributes.blockId]}function N(){se||(se=!0,goog.provide("Blockly.Blocks.device"),goog.require("Blockly.Blocks"),window.PointerEvent&&(Blockly.bindEvent_.TOUCH_MAP={mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},document.body.style.touchAction="none"),Blockly.FieldCheckbox.CHECK_CHAR="â– ",Blockly.BlockSvg.START_HAT=!!e.appTarget.appTheme.blockHats,t.initFieldEditors(),R(),V(),U(),G(),W(),O(),L(),X(),q(),F())}function w(t,o){var i=e.blocks.getBlockDefinition(o);S(t,o,i.name,i.tooltip,i.url,H(i.category))}function I(t){var o=e.blocks.getBlockDefinition(t);D(t,o.name,o.tooltip,o.url,H(o.category))}function S(e,o,i,r,n,l,a,s,c){!r||"string"!=typeof r&&"function"!=typeof r||e.setTooltip(r),n&&e.setHelpUrl(n),l&&e.setColour(l,a,s),c&&e.setDeletable(!1);var u=document.getElementById("blocklyToolboxDefinition"),p=u?t.getFirstChildWithAttr(u,"block","type",o):void 0;e.codeCard={header:i,name:i,software:1,description:goog.isFunction(r)?r(e):r,blocksXml:p?'<xml xmlns="http://www.w3.org/1999/xhtml">'+(k(p)||'<block type="'+o+'"></block>')+"</xml>":void 0,url:n}}function D(e,t,o,i,r,n,l){var a=Blockly.Blocks[e],s=a.init;s&&(a.init=function(){s.call(this);S(this,e,t,o,i,r,n,l)})}function O(){var t=Blockly.Msg,o=e.blocks.getBlockDefinition("lists_create_with");t.LISTS_CREATE_EMPTY_TITLE=o.block.LISTS_CREATE_EMPTY_TITLE,t.LISTS_CREATE_WITH_INPUT_WITH=o.block.LISTS_CREATE_WITH_INPUT_WITH,t.LISTS_CREATE_WITH_CONTAINER_TITLE_ADD=o.block.LISTS_CREATE_WITH_CONTAINER_TITLE_ADD,t.LISTS_CREATE_WITH_ITEM_TITLE=o.block.LISTS_CREATE_WITH_ITEM_TITLE,I("lists_create_with");var i=e.blocks.getBlockDefinition("lists_length");t.LISTS_LENGTH_TITLE=i.block.LISTS_LENGTH_TITLE,Blockly.Blocks.lists_length.init=function(){this.jsonInit({message0:t.LISTS_LENGTH_TITLE,args0:[{type:"input_value",name:"VALUE",check:["Array"]}],output:"Number"})},I("lists_length")}function L(){var t=Blockly.Msg,o=e.blocks.getBlockDefinition("controls_repeat_ext");t.CONTROLS_REPEAT_TITLE=o.block.CONTROLS_REPEAT_TITLE,t.CONTROLS_REPEAT_INPUT_DO=o.block.CONTROLS_REPEAT_INPUT_DO,I("controls_repeat_ext");var i=e.blocks.getBlockDefinition("device_while");Blockly.Blocks.device_while={init:function(){this.jsonInit({message0:i.block.message0,args0:[{type:"input_value",name:"COND",check:"Boolean"}],previousStatement:null,nextStatement:null,colour:H("loops")}),this.appendStatementInput("DO").appendField(i.block.appendField),w(this,"device_while")}};var r=e.blocks.getBlockDefinition("controls_simple_for");Blockly.Blocks.controls_simple_for={init:function(){this.jsonInit({message0:r.block.message0,args0:[{type:"field_variable",name:"VAR",variable:r.block.variable},{type:"input_value",name:"TO",check:"Number"}],previousStatement:null,nextStatement:null,colour:H("loops"),inputsInline:!0}),this.appendStatementInput("DO").appendField(r.block.appendField);var t=this;S(this,"controls_simple_for",r.name,function(){return e.U.rlf(r.tooltip,t.getFieldValue("VAR"))},r.url,String(H("loops")))},getVars:function(){return[this.getFieldValue("VAR")]},renameVar:function(e,t){Blockly.Names.equals(e,this.getFieldValue("VAR"))&&this.setFieldValue(t,"VAR")},customContextMenu:function(e){if(!this.isCollapsed()){var t={enabled:!0},o=this.getFieldValue("VAR");t.text=lf("Create 'get {0}'",o);var i=goog.dom.createDom("field",null,o);i.setAttribute("name","VAR");var r=goog.dom.createDom("block",null,i);r.setAttribute("type","variables_get"),t.callback=Blockly.ContextMenu.callbackFactory(this,r),e.push(t)}}}}function F(){var e=function(e,t){return Math.floor(t-(e.left+e.width/2))},t=Blockly.BlockDragger.prototype.dragBlock;Blockly.BlockDragger.prototype.dragBlock=function(o,i){var r=document.getElementsByClassName("blocklyToolboxDiv")[0],n=document.getElementsByClassName("blocklyTreeRoot")[0],l=document.getElementById("blocklyTrashIcon");if(n&&l){var a=e(n.getBoundingClientRect(),o.clientX);if(a<200){var s=a/200;l.style.opacity=""+(1-s),l.style.display="block",n.style.opacity=""+s,a<50&&r.classList.add("blocklyToolboxDeleting")}else l.style.display="none",n.style.opacity="1",r.classList.remove("blocklyToolboxDeleting")}return t.call(this,o,i)};var o=Blockly.BlockDragger.prototype.endBlockDrag;Blockly.BlockDragger.prototype.endBlockDrag=function(e,t){o.call(this,e,t);var i=document.getElementsByClassName("blocklyToolboxDiv")[0],r=document.getElementsByClassName("blocklyTreeRoot")[0],n=document.getElementById("blocklyTrashIcon");n&&(n.style.display="none",r.style.opacity="1",i.classList.remove("blocklyToolboxDeleting"))}}function R(){var o=Blockly.Msg;o.DUPLICATE_BLOCK=lf("{id:block}Duplicate"),o.REMOVE_COMMENT=lf("Remove Comment"),o.ADD_COMMENT=lf("Add Comment"),o.EXTERNAL_INPUTS=lf("External Inputs"),o.INLINE_INPUTS=lf("Inline Inputs"),o.EXPAND_BLOCK=lf("Expand Block"),o.COLLAPSE_BLOCK=lf("Collapse Block"),o.ENABLE_BLOCK=lf("Enable Block"),o.DISABLE_BLOCK=lf("Disable Block"),o.DELETE_BLOCK=lf("Delete Block"),o.DELETE_X_BLOCKS=lf("Delete All Blocks"),o.HELP=lf("Help"),Blockly.BlockSvg.prototype.showHelp_=function(){var t=goog.isFunction(this.helpUrl)?this.helpUrl():this.helpUrl;t&&(e.blocks.openHelpUrl||window.open)(t)},Blockly.WorkspaceSvg.prototype.showContextMenu_=function(o){function i(e){if(e.isDeletable())b=b.concat(e.getDescendants());else for(var t=e.getChildren(),o=0;o<t.length;o++)i(t[o])}function r(){Blockly.Events.setGroup(s);var e=b.shift();e&&(e.workspace?(e.dispose(!1,!0),setTimeout(r,c)):r()),Blockly.Events.setGroup(!1)}var n=this;if(!this.options.readOnly&&!this.isFlyout){var l=[],a=this.getTopBlocks(!0),s=Blockly.utils.genUid(),c=10;if(this.options.collapse){for(var u=!1,p=!1,d=0;d<a.length;d++)for(var h=a[d];h;)h.isCollapsed()?u=!0:p=!0,h=h.getNextBlock();var m=function(e){for(var t=0,o=0;o<a.length;o++)for(var i=a[o];i;)setTimeout(i.setCollapsed.bind(i,e),t),i=i.getNextBlock(),t+=c},f={enabled:p};f.text=lf("Collapse Block"),f.callback=function(){e.tickEvent("blocks.context.collapse"),m(!0)},l.push(f);var g={enabled:u};g.text=lf("Expand Block"),g.callback=function(){e.tickEvent("blocks.context.expand"),m(!1)},l.push(g)}for(var b=[],d=0;d<a.length;d++)i(a[d]);var k={text:1==b.length?lf("Delete Block"):lf("Delete All Blocks",b.length),enabled:b.length>0,callback:function(){e.tickEvent("blocks.context.delete"),(b.length<2||window.confirm(lf("Delete all {0} blocks?",b.length)))&&r()}};l.push(k);var y={text:lf("Format Code"),enabled:!0,callback:function(){e.tickEvent("blocks.context.format"),e.blocks.layout.flow(n,{useViewWidth:!0})}};if(l.push(y),e.blocks.layout.screenshotEnabled()){var v={text:lf("Download Screenshot"),enabled:a.length>0,callback:function(){e.tickEvent("blocks.context.screenshot"),e.blocks.layout.screenshotAsync(n).done(function(t){e.BrowserUtils.isSafari()&&(t=t.replace(/^data:image\/[^;]/,"data:application/octet-stream")),e.BrowserUtils.browserDownloadDataUri(t,(e.appTarget.nickname||e.appTarget.id)+"-"+lf("screenshot")+".png")})}};l.push(v)}t.onShowContextMenu&&t.onShowContextMenu(this,l),Blockly.ContextMenu.show(o,l,this.RTL)}},Blockly.Toolbox.TreeNode.prototype.onClick_=function(e){var t=this;t.isSelected()||P(t.getTree().getSelectedItem(),t),t.hasChildren()&&t.isUserCollapsible_?t.isSelected()?(P(t.getTree().getSelectedItem(),t),t.getTree().setSelectedItem(null)):(t.setExpanded(!0),t.select()):t.isSelected()?t.getTree().setSelectedItem(null):t.select(),t.updateRow()};var i=Blockly.Toolbox.TreeControl.prototype.setSelectedItem;Blockly.Toolbox.TreeControl.prototype.setSelectedItem=function(e){var t=this,o=t.toolbox_;if(e!=t.selectedItem_&&e!=o.tree_){var r=t.selectedItem_;i.call(t,e),null===e&&P(r)}},Blockly.Flyout.prototype.addBlockListeners_=function(e,t,o){this.listeners_.push(Blockly.bindEventWithChecks_(e,"mousedown",null,this.blockMouseDown_(t))),this.listeners_.push(Blockly.bindEventWithChecks_(o,"mousedown",null,this.blockMouseDown_(t))),this.listeners_.push(Blockly.bindEvent_(e,"mouseover",t,t.addSelect)),this.listeners_.push(Blockly.bindEvent_(e,"mouseout",t,t.removeSelect)),this.listeners_.push(Blockly.bindEvent_(o,"mouseover",t,t.addSelect)),this.listeners_.push(Blockly.bindEvent_(o,"mouseout",t,t.removeSelect))}}function P(e,t){for(;e;)!e.isUserCollapsible_||!e.getTree()||e==t||t&&M(t,e)||(e.setExpanded(!1),e.updateRow()),e=e.getParent()}function M(e,t){var o=e.getParent();return!!o&&(o===t||M(o,t))}function V(){var o=e.blocks.getBlockDefinition(ts.pxtc.ON_START_TYPE);Blockly.Blocks[ts.pxtc.ON_START_TYPE]={init:function(){this.jsonInit({message0:o.block.message0,args0:[{type:"input_dummy"},{type:"input_statement",name:"HANDLER"}],colour:(e.appTarget.runtime?e.appTarget.runtime.onStartColor:"")||H("loops")}),S(this,ts.pxtc.ON_START_TYPE,o.name,o.tooltip,o.url,String((e.appTarget.runtime?e.appTarget.runtime.onStartColor:"")||H("loops")),void 0,void 0,!!e.appTarget.runtime&&e.appTarget.runtime.onStartUnDeletable)}},Blockly.Blocks[pxtc.TS_STATEMENT_TYPE]={init:function(){var e=this,t=this;t.setColour("#717171"),t.setPreviousStatement(!0),t.setNextStatement(!0),t.setInputsInline(!1),this.domToMutation=function(o){var i=parseInt(o.getAttribute("numlines"));e.declaredVariables=o.getAttribute("declaredvars");for(var r=0;r<i;r++){var n=o.getAttribute("line"+r);t.appendDummyInput().appendField(n,"LINE"+r)}},this.mutationToDom=function(){for(var o=document.createElement("mutation"),i=0;;){var r=t.getFieldValue("LINE"+i);if(null===r)break;o.setAttribute("line"+i,r),i++}return o.setAttribute("numlines",i.toString()),e.declaredVariables&&o.setAttribute("declaredvars",e.declaredVariables),o},t.setEditable(!1),S(this,pxtc.TS_STATEMENT_TYPE,lf("JavaScript statement"),lf("A JavaScript statement that could not be converted to blocks"),"/blocks/javascript-blocks","#717171")}},Blockly.Blocks[pxtc.TS_OUTPUT_TYPE]={init:function(){var e=this;e.setColour("#717171"),e.setPreviousStatement(!1),e.setNextStatement(!1),e.setOutput(!0),e.setEditable(!1),e.appendDummyInput().appendField(new pxtblockly.FieldTsExpression(""),"EXPRESSION"),S(e,pxtc.TS_OUTPUT_TYPE,lf("JavaScript expression"),lf("A JavaScript expression that could not be converted to blocks"),"/blocks/javascript-blocks","#717171")}};var i=e.blocks.getBlockDefinition("controls_for_of");Blockly.Blocks.controls_for_of={init:function(){this.jsonInit({message0:i.block.message0,args0:[{type:"field_variable",name:"VAR",variable:i.block.variable},{type:"input_value",name:"LIST",check:"Array"}],previousStatement:null,nextStatement:null,colour:t.blockColors.loops,inputsInline:!0}),this.appendStatementInput("DO").appendField(i.block.appendField);var o=this;S(this,"controls_for_of",i.name,function(){return e.U.rlf(i.tooltip,o.getFieldValue("VAR"))},i.url,String(H("loops")))}};var r=e.blocks.getBlockDefinition("lists_index_get");Blockly.Blocks.lists_index_get={init:function(){this.jsonInit({message0:r.block.message0,args0:[{type:"input_value",name:"LIST",check:"Array"},{type:"input_value",name:"INDEX",check:"Number"}],colour:t.blockColors.arrays,inputsInline:!0}),this.setPreviousStatement(!1),this.setNextStatement(!1),this.setOutput(!0),w(this,"lists_index_get")}};var n=e.blocks.getBlockDefinition("lists_index_set");Blockly.Blocks.lists_index_set={init:function(){this.jsonInit({message0:n.block.message0,args0:[{type:"input_value",name:"LIST",check:"Array"},{type:"input_value",name:"INDEX",check:"Number"},{type:"input_value",name:"VALUE",check:null}],previousStatement:null,nextStatement:null,colour:t.blockColors.arrays,inputsInline:!0}),w(this,"lists_index_set")}}}function U(){var t=e.blocks.getBlockDefinition("math_op2"),o=t.tooltip;Blockly.Blocks.math_op2={init:function(){this.jsonInit({message0:lf("%1 of %2 and %3"),args0:[{type:"field_dropdown",name:"op",options:[[lf("{id:op}min"),"min"],[lf("{id:op}max"),"max"]]},{type:"input_value",name:"x",check:"Number"},{type:"input_value",name:"y",check:"Number"}],inputsInline:!0,output:"Number",colour:H("math")});S(this,"math_op2",t.name,function(e){return o[e.getFieldValue("op")]},t.url,H(t.category))}};var i=e.blocks.getBlockDefinition("math_op3");Blockly.Blocks.math_op3={init:function(){this.jsonInit({message0:i.block.message0,args0:[{type:"input_value",name:"x",check:"Number"}],inputsInline:!0,output:"Number",colour:H("math")}),w(this,"math_op3")}};var r=e.blocks.getBlockDefinition("math_number");D("math_number",r.name,lf(e.appTarget.compile&&e.appTarget.compile.floatingPoint?"a decimal number":"an integer number"),r.url,Blockly.Colours.textField,Blockly.Colours.textField,Blockly.Colours.textField);var n=e.blocks.getBlockDefinition("math_number_minmax");D("math_number_minmax",n.name,lf(e.appTarget.compile&&e.appTarget.compile.floatingPoint?"a decimal number":"an integer number"),n.url,Blockly.Colours.textField,Blockly.Colours.textField,Blockly.Colours.textField);var l=Blockly.Msg,a=e.blocks.getBlockDefinition("math_arithmetic"),s=a.tooltip;l.MATH_ADDITION_SYMBOL=a.block.MATH_ADDITION_SYMBOL,l.MATH_SUBTRACTION_SYMBOL=a.block.MATH_SUBTRACTION_SYMBOL,l.MATH_MULTIPLICATION_SYMBOL=a.block.MATH_MULTIPLICATION_SYMBOL,l.MATH_DIVISION_SYMBOL=a.block.MATH_DIVISION_SYMBOL,l.MATH_POWER_SYMBOL=a.block.MATH_POWER_SYMBOL,D("math_arithmetic",a.name,function(e){return s[e.getFieldValue("OP")]},a.url,H(a.category));var c=e.blocks.getBlockDefinition("math_modulo");l.MATH_MODULO_TITLE=c.block.MATH_MODULO_TITLE,I("math_modulo")}function H(o){return e.appTarget.appTheme.blockColors&&e.appTarget.appTheme.blockColors[o]?e.appTarget.appTheme.blockColors[o]:t.blockColors[o]?t.blockColors[o]:""}function G(){var t=lf("{id:var}item");Blockly.Variables.flyoutCategory=function(t){var o=[];if(!e.appTarget.appTheme.hideFlyoutHeadings){var i=goog.dom.createDom("label");i.setAttribute("text",lf("Variables")),i.setAttribute("web-class","blocklyFlyoutHeading"),i.setAttribute("web-icon","ï€¹"),i.setAttribute("web-icon-color",H("variables")),o.push(i)}var r=goog.dom.createDom("button");r.setAttribute("text",lf("Make a Variable")),r.setAttribute("callbackkey","CREATE_VARIABLE"),t.registerButtonCallback("CREATE_VARIABLE",function(e){Blockly.Variables.createVariable(e.getTargetWorkspace())}),o.push(r);var n=Blockly.Variables.flyoutCategoryBlocks(t);return o=o.concat(n)},Blockly.Variables.flyoutCategoryBlocks=function(e){var o=e.getVariablesOfType("");o.sort(Blockly.VariableModel.compareByName);for(var i=0,r=void 0;r=o[i];i++)if(r.name==t){o.splice(i,1);break}var n=new Blockly.VariableModel(e,t);o.unshift(n);var l=[];if(o.length>0){for(var i=0,a=void 0;a=o[i];i++)if(Blockly.Blocks.variables_get){var s='<xml><block type="variables_get" gap="8">'+Blockly.Variables.generateVariableFieldXml_(a)+"</block></xml>",c=Blockly.Xml.textToDom(s).firstChild;l.push(c)}l[l.length-1].setAttribute("gap","24");var u=o[0];if(Blockly.Blocks.variables_set){var s='<xml><block type="variables_set" gap="'+(p=Blockly.Blocks.variables_change?8:24)+'">'+Blockly.Variables.generateVariableFieldXml_(u)+"</block></xml>",c=Blockly.Xml.textToDom(s).firstChild;(d=goog.dom.createDom("value")).setAttribute("name","VALUE"),(h=goog.dom.createDom("shadow")).setAttribute("type","math_number"),d.appendChild(h),(m=goog.dom.createDom("field")).setAttribute("name","NUM"),m.appendChild(document.createTextNode("0")),h.appendChild(m),c.appendChild(d),l.push(c)}if(Blockly.Blocks.variables_change){var p=Blockly.Blocks.variables_get?20:8,s='<xml><block type="variables_change" gap="'+p+'">'+Blockly.Variables.generateVariableFieldXml_(u)+'<value name="DELTA"><shadow type="math_number"><field name="NUM">1</field></shadow></value></block></xml>',c=Blockly.Xml.textToDom(s).firstChild,d=goog.dom.createDom("value");d.setAttribute("name","VALUE");var h=goog.dom.createDom("shadow");h.setAttribute("type","math_number"),d.appendChild(h);var m=goog.dom.createDom("field");m.setAttribute("name","NUM"),m.appendChild(document.createTextNode("1")),h.appendChild(m),c.appendChild(d),l.push(c)}}return l};var o=Blockly.Msg,i=e.blocks.getBlockDefinition("variables_get");o.VARIABLES_GET_CREATE_SET=i.block.VARIABLES_GET_CREATE_SET,I("variables_get"),o.RENAME_VARIABLE=lf("Rename variable..."),o.DELETE_VARIABLE=lf('Delete the "%1" variable'),o.DELETE_VARIABLE_CONFIRMATION=lf('Delete %1 uses of the "%2" variable?');var r=e.blocks.getBlockDefinition("variables_set");o.VARIABLES_SET=r.block.VARIABLES_SET,o.VARIABLES_DEFAULT_NAME=t,o.VARIABLES_SET_CREATE_GET=lf("Create 'get %1'"),I("variables_set");var n=e.blocks.getBlockDefinition("variables_change");Blockly.Blocks.variables_change={init:function(){this.jsonInit({message0:n.block.message0,args0:[{type:"field_variable",name:"VAR",variable:t},{type:"input_value",name:"VALUE",check:"Number"}],inputsInline:!0,previousStatement:null,nextStatement:null,colour:H("variables")}),w(this,"variables_change")}},o.NEW_VARIABLE_TITLE=lf("New variable name:")}function W(){var t=Blockly.Msg,o=e.blocks.getBlockDefinition("procedures_defnoreturn");t.PROCEDURES_DEFNORETURN_TITLE=o.block.PROCEDURES_DEFNORETURN_TITLE,t.PROCEDURE_ALREADY_EXISTS=o.block.PROCEDURE_ALREADY_EXISTS,Blockly.Blocks.procedures_defnoreturn.init=function(){var e=new Blockly.FieldTextInput("",Blockly.Procedures.rename);this.appendDummyInput().appendField(Blockly.Msg.PROCEDURES_DEFNORETURN_TITLE).appendField(e,"NAME").appendField("","PARAMS"),this.setColour(H("functions")),this.arguments_=[],this.setStartHat(!0),this.setStatements_(!0),this.statementConnection_=null},I("procedures_defnoreturn");var i=e.blocks.getBlockDefinition("procedures_callnoreturn");t.PROCEDURES_CALLRETURN_TOOLTIP=o.tooltip,Blockly.Blocks.procedures_callnoreturn={init:function(){var e=new pxtblockly.FieldProcedure("");e.setSourceBlock(this),this.appendDummyInput("TOPROW").appendField(i.block.PROCEDURES_CALLNORETURN_TITLE).appendField(e,"NAME"),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setColour(H("functions")),this.arguments_=[],this.quarkConnections_={},this.quarkIds_=null},getProcedureCall:function(){return this.getFieldValue("NAME")},renameProcedure:function(e,t){Blockly.Names.equals(e,this.getProcedureCall())&&this.setFieldValue(t,"NAME")},onchange:function(e){if(this.workspace&&!this.workspace.isFlyout&&!this.isInsertionMarker())if(e.type==Blockly.Events.CREATE&&-1!=e.ids.indexOf(this.id)){var t=this.getProcedureCall();if(!(c=Blockly.Procedures.getDefinition(t,this.workspace))||c.type==this.defType_&&JSON.stringify(c.arguments_)==JSON.stringify(this.arguments_)||(c=null),!c){Blockly.Events.setGroup(e.group);var o=goog.dom.createDom("xml"),i=goog.dom.createDom("block");i.setAttribute("type",this.defType_);var r=this.getRelativeToSurfaceXY(),n=r.x+Blockly.SNAP_RADIUS*(this.RTL?-1:1),l=r.y+2*Blockly.SNAP_RADIUS;i.setAttribute("x",n),i.setAttribute("y",l);var a=goog.dom.createDom("field");a.setAttribute("name","NAME"),a.appendChild(document.createTextNode(this.getProcedureCall())),i.appendChild(a),o.appendChild(i),Blockly.Xml.domToWorkspace(o,this.workspace),Blockly.Events.setGroup(!1)}}else if(e.type==Blockly.Events.DELETE){var s=this.getProcedureCall(),c=Blockly.Procedures.getDefinition(s,this.workspace);c||(Blockly.Events.setGroup(e.group),this.dispose(!0,!1),Blockly.Events.setGroup(!1))}},mutationToDom:function(){var e=document.createElement("mutation");return e.setAttribute("name",this.getProcedureCall()),e},domToMutation:function(e){var t=e.getAttribute("name");this.renameProcedure(this.getProcedureCall(),t)},customContextMenu:function(e){var t={enabled:!0};t.text=Blockly.Msg.PROCEDURES_HIGHLIGHT_DEF;var o=this.getProcedureCall(),i=this.workspace;t.callback=function(){var e=Blockly.Procedures.getDefinition(o,i);e&&e.select()},e.push(t)},defType_:"procedures_defnoreturn"},I("procedures_callnoreturn"),Blockly.Procedures.flyoutCategory=function(t){var o=[];if(!e.appTarget.appTheme.hideFlyoutHeadings){var i=goog.dom.createDom("label");i.setAttribute("text",lf("Functions")),i.setAttribute("web-class","blocklyFlyoutHeading"),i.setAttribute("web-icon","ï„‰"),i.setAttribute("web-icon-class","blocklyFlyoutIconfunctions"),i.setAttribute("web-icon-color",H("functions")),o.push(i)}var r=lf("Make a Function"),n=lf("New function name:"),l=goog.dom.createDom("button");l.setAttribute("text",r),l.setAttribute("callbackkey","CREATE_FUNCTION");var a=function(e){var o=t.getTopBlocks(!0)[0],i=0,r=0;if(o){var n=o.getRelativeToSurfaceXY();i=n.x+Blockly.SNAP_RADIUS*(o.RTL?-1:1),r=n.y+2*Blockly.SNAP_RADIUS}var l=goog.dom.createDom("xml"),a=goog.dom.createDom("block");a.setAttribute("type","procedures_defnoreturn"),a.setAttribute("x",String(i)),a.setAttribute("y",String(r));var s=goog.dom.createDom("field");s.setAttribute("name","NAME"),s.appendChild(document.createTextNode(e)),a.appendChild(s),l.appendChild(a);var c=Blockly.Xml.domToWorkspace(l,t);t.toolbox_.clearSelection(),t.getBlockById(c[0]).select()};return t.registerButtonCallback("CREATE_FUNCTION",function(e){var o=function(e){Blockly.prompt(n,e,function(e){e&&(e=e.replace(/[\s\xa0]+/g," ").replace(/^ | $/g,""))==r&&(e=null),e&&(t.getVariable(e)?Blockly.alert(Blockly.Msg.VARIABLE_ALREADY_EXISTS.replace("%1",e.toLowerCase()),function(){o(e)}):Blockly.Procedures.isLegalName_(e,t)?a(e):Blockly.alert(Blockly.Msg.PROCEDURE_ALREADY_EXISTS.replace("%1",e.toLowerCase()),function(){o(e)}))})};o("doSomething")}),o.push(l),function(e,t){for(var i=0;i<e.length;i++){var r=e[i][0],n=(e[i][1],goog.dom.createDom("block"));n.setAttribute("type",t),n.setAttribute("gap","16"),n.setAttribute("colour",H("functions"));var l=goog.dom.createDom("field",null,r);l.setAttribute("name","NAME"),n.appendChild(l),o.push(n)}}(Blockly.Procedures.allProcedures(t)[0],"procedures_callnoreturn"),o}}function X(){var t=Blockly.Msg,o=e.blocks.getBlockDefinition("controls_if"),i=o.tooltip;t.CONTROLS_IF_MSG_IF=o.block.CONTROLS_IF_MSG_IF,t.CONTROLS_IF_MSG_THEN=o.block.CONTROLS_IF_MSG_THEN,t.CONTROLS_IF_MSG_ELSE=o.block.CONTROLS_IF_MSG_ELSE,t.CONTROLS_IF_MSG_ELSEIF=o.block.CONTROLS_IF_MSG_ELSEIF,t.CONTROLS_IF_TOOLTIP_1=i.CONTROLS_IF_TOOLTIP_1,t.CONTROLS_IF_TOOLTIP_2=i.CONTROLS_IF_TOOLTIP_2,t.CONTROLS_IF_TOOLTIP_3=i.CONTROLS_IF_TOOLTIP_3,t.CONTROLS_IF_TOOLTIP_4=i.CONTROLS_IF_TOOLTIP_4,I("controls_if");var r=e.blocks.getBlockDefinition("logic_compare").tooltip;t.LOGIC_COMPARE_TOOLTIP_EQ=r.LOGIC_COMPARE_TOOLTIP_EQ,t.LOGIC_COMPARE_TOOLTIP_NEQ=r.LOGIC_COMPARE_TOOLTIP_NEQ,t.LOGIC_COMPARE_TOOLTIP_LT=r.LOGIC_COMPARE_TOOLTIP_LT,t.LOGIC_COMPARE_TOOLTIP_LTE=r.LOGIC_COMPARE_TOOLTIP_LTE,t.LOGIC_COMPARE_TOOLTIP_GT=r.LOGIC_COMPARE_TOOLTIP_GT,t.LOGIC_COMPARE_TOOLTIP_GTE=r.LOGIC_COMPARE_TOOLTIP_GTE,I("logic_compare");var n=e.blocks.getBlockDefinition("logic_operation"),l=n.tooltip;t.LOGIC_OPERATION_AND=n.block.LOGIC_OPERATION_AND,t.LOGIC_OPERATION_OR=n.block.LOGIC_OPERATION_OR,t.LOGIC_OPERATION_TOOLTIP_AND=l.LOGIC_OPERATION_TOOLTIP_AND,t.LOGIC_OPERATION_TOOLTIP_OR=l.LOGIC_OPERATION_TOOLTIP_OR,I("logic_operation");var a=e.blocks.getBlockDefinition("logic_negate");t.LOGIC_NEGATE_TITLE=a.block.LOGIC_NEGATE_TITLE,I("logic_negate");var s=e.blocks.getBlockDefinition("logic_boolean");t.LOGIC_BOOLEAN_TRUE=s.block.LOGIC_BOOLEAN_TRUE,t.LOGIC_BOOLEAN_FALSE=s.block.LOGIC_BOOLEAN_FALSE,I("logic_boolean")}function q(){var t=e.blocks.getBlockDefinition("text");D("text",t.name,t.tooltip,t.url,Blockly.Colours.textField,Blockly.Colours.textField,Blockly.Colours.textField);var o=Blockly.Msg,i=e.blocks.getBlockDefinition("text_length");o.TEXT_LENGTH_TITLE=i.block.TEXT_LENGTH_TITLE,Blockly.Blocks.text_length.init=function(){this.jsonInit({message0:o.TEXT_LENGTH_TITLE,args0:[{type:"input_value",name:"VALUE",check:["String"]}],output:"Number"})},I("text_length");var r=e.blocks.getBlockDefinition("text_join");o.TEXT_JOIN_TITLE_CREATEWITH=r.block.TEXT_JOIN_TITLE_CREATEWITH,I("text_join")}function Y(t){var o=function(e){if(e.disabled)return lf("This block is disabled and will not run. Attach this block to an event to enable it.");for(var t=e.tooltip;goog.isFunction(t);)t=t(e);return t};Blockly.Tooltip.show_=function(){function t(){var e=Blockly.Tooltip.element_.RTL,t=goog.dom.getViewportSize();Blockly.Tooltip.DIV.style.direction=e?"rtl":"ltr",Blockly.Tooltip.DIV.style.display="block",Blockly.Tooltip.visible=!0;var o=Blockly.Tooltip.lastX_;e?o-=Blockly.Tooltip.OFFSET_X+Blockly.Tooltip.DIV.offsetWidth:o+=Blockly.Tooltip.OFFSET_X;var i=Blockly.Tooltip.lastY_+Blockly.Tooltip.OFFSET_Y;i+Blockly.Tooltip.DIV.offsetHeight>t.height+window.scrollY&&(i-=Blockly.Tooltip.DIV.offsetHeight+2*Blockly.Tooltip.OFFSET_Y),e?o=Math.max(Blockly.Tooltip.MARGINS-window.scrollX,o):o+Blockly.Tooltip.DIV.offsetWidth>t.width+window.scrollX-2*Blockly.Tooltip.MARGINS&&(o=t.width-Blockly.Tooltip.DIV.offsetWidth-2*Blockly.Tooltip.MARGINS),Blockly.Tooltip.DIV.style.top=i+"px",Blockly.Tooltip.DIV.style.left=o+"px"}if(Blockly.Tooltip.poisonedElement_=Blockly.Tooltip.element_,Blockly.Tooltip.DIV)if(goog.dom.removeChildren(Blockly.Tooltip.DIV),Blockly.Tooltip.element_.codeCard){var i=e.docs.codeCard.render({header:o(Blockly.Tooltip.element_)});Blockly.Tooltip.DIV.appendChild(i),t()}else{for(var r=o(Blockly.Tooltip.element_),n=(r=Blockly.utils.wrap(r,Blockly.Tooltip.LIMIT)).split("\n"),l=0;l<n.length;l++){var a=document.createElement("div");a.appendChild(document.createTextNode(n[l])),Blockly.Tooltip.DIV.appendChild(a)}t()}}}function j(t){var o=ce[t];{if(o)return new Blockly.FieldImage(o,56,56,!1,"");e.log("missing jres icon "+t)}}function z(e){ce={};var t=e.apis.jres;t&&Object.keys(t).forEach(function(e){var o=t[e];o&&o.icon&&(ce[e]=o.icon)})}t.blockColors={loops:"#107c10",logic:"#006970",math:"#712672",images:"#5C2D91",variables:"#A80000",functions:"#005a9e",text:"#996600",arrays:"#A94400",advanced:"#3c3c3c"},function(e){e[e.All=0]="All",e[e.None=1]="None",e[e.Basic=2]="Basic"}(t.CategoryMode||(t.CategoryMode={}));var K=t.CategoryMode,J={string:{field:"TEXT",block:"text",defaultValue:""},number:{field:"NUM",block:"math_number",defaultValue:"0"},boolean:{field:"BOOL",block:"logic_boolean",defaultValue:"false"},Array:{field:"VAR",block:"variables_get",defaultValue:"list"}};t.advancedTitle=o,t.addPackageTitle=i;var Q=/^(?:Array<.+>)|(?:.+\[\])|(?:\[.+\])$/,Z={},ee=!1,te={};Object.keys(Blockly.Blocks).forEach(function(e){return te[e]={block:Blockly.Blocks[e]}}),t.buildinBlockStatements={controls_if:!0,controls_for:!0,controls_simple_for:!0,controls_repeat_ext:!0,variables_set:!0,variables_change:!0,device_while:!0};var oe={},ie={};t.blockSymbol=function(e){var t=oe[e];return t?t.fn:void 0};var re,ne="";t.appendToolboxIconCss=c,t.injectToolboxIconCss=u;var le="";t.appendNamespaceCss=p,t.hasArrowFunction=T,function(e){e[e.Hidden=0]="Hidden",e[e.Visible=1]="Visible",e[e.Disabled=2]="Disabled"}(t.FilterState||(t.FilterState={}));var ae=t.FilterState;t.createToolbox=B,t.initBlocks=function(e,t,o,i,r){void 0===o&&(o=K.Basic),N(),Y(),z(e);var n=B(e,t,o,i,r);if(!document.getElementById("blocklyTrashIcon")){var l=document.createElement("div");l.id="blocklyTrashIcon",l.style.opacity="0",l.style.display="none";var a=document.createElement("i");a.className="trash icon",l.appendChild(a);var s=document.getElementsByClassName("injectionDiv")[0];s&&s.appendChild(l)}return n},t.initSearch=function(o,i,r,n,a){var s=document.getElementById("blocklySearchInputField"),c=document.getElementById("blocklySearchInput"),u=document.getElementById("blocklySearchLabel");if(!c){var p=document.createElement("div");p.id="blocklySearchArea",(c=document.createElement("div")).id="blocklySearchInput",c.className="ui fluid icon input",c.setAttribute("role","search"),(s=document.createElement("input")).type="text",s.placeholder=lf("Search..."),s.id="blocklySearchInputField",s.className="blocklySearchInputField";var h=document.createElement("i");h.className="search icon",h.setAttribute("role","presentation"),h.setAttribute("aria-hidden","true"),(u=document.createElement("div")).className="accessible-hidden",u.id="blocklySearchLabel",u.setAttribute("aria-live","polite"),c.appendChild(s),c.appendChild(h),c.appendChild(u),p.appendChild(c);var m=document.getElementsByClassName("blocklyToolboxDiv")[0];m&&m.insertBefore(p,m.firstChild)}var f=function(){return document.getElementsByClassName("blocklyTreeIconsearch").length>0},g=function(){var e=o.toolbox_.tree_;e.setSelectedItem(e.getChildren()[0])};e.blocks.cachedSearchTb=i,e.blocks.cachedSearchTbAll=r;var b="",k=e.Util.debounce(function(){var o=document.getElementById("blocklySearchInputField").value.toLowerCase(),r=document.getElementById("blocklySearchLabel");if(r.textContent="",""!=o){c.className+=" loading",b=o,e.tickEvent("blocks.search");var u=e.blocks.cachedSearchTb?e.blocks.cachedSearchTb.cloneNode(!0):void 0,p=A(u,"Search");if(!p){var h=d(u),m=u;(p=l(lf("{id:category}Search"),"Search",101)).setAttribute("colour","#000"),p.setAttribute("iconclass","blocklyTreeIconsearch"),p.setAttribute("expandedclass","blocklyTreeIconsearch");var f=0;for(f=0;f<h.length;++f){var k=h[f];if(parseInt(k.getAttribute("weight")||"50")<101){m.insertBefore(p,k);break}}f==h.length&&m.appendChild(p)}n({term:o,subset:ee?Z:void 0}).then(function(i){if(e.log("searching for: "+o),ee=!1,i){if(0==i.length?r.textContent=lf("No search results..."):r.textContent=lf("{0} result matching '{1}'",i.length,s.value.toLowerCase()),0==i.length){var n=goog.dom.createDom("label");return n.setAttribute("text",lf("No search results...")),void p.appendChild(n)}i.forEach(function(o){if(e.blocks.cachedSearchTbAll){var i=o.id,r=ie[i];if(!r){var n=t.getFirstChildWithAttr(e.blocks.cachedSearchTbAll,"block","type",i);n&&(r=ie[i]=n.cloneNode(!0))}r&&p.appendChild(r)}})}}).finally(function(){i&&(a(u),c.className="ui fluid icon input",g())})}else""!=b&&(a(e.blocks.cachedSearchTb),c.className="ui fluid icon input")},300,!1);s.oninput=k,s.onfocus=function(){s.select(),""!=s.value.toLowerCase()&&(f()?g():(b="",k()))},e.BrowserUtils.isTouchEnabled()&&(s.ontouchstart=function(){s.focus()}),Blockly.Toolbox.TreeNode.prototype.onKeyDown=function(e){var t=e.which||e.keyCode,o=t>64&&t<91,i=e.ctrlKey||e.metaKey;if(o&&!i){var r=document.getElementById("blocklySearchInputField"),n=String.fromCharCode(t);return r.focus(),r.value=r.value+n,!0}if(this.getTree()&&this.getTree().toolbox_.horizontalLayout_){var l={},a=goog.events.KeyCodes.DOWN,s=goog.events.KeyCodes.UP;l[goog.events.KeyCodes.RIGHT]=this.rightToLeft_?s:a,l[goog.events.KeyCodes.LEFT]=this.rightToLeft_?a:s,l[goog.events.KeyCodes.UP]=goog.events.KeyCodes.LEFT,l[goog.events.KeyCodes.DOWN]=goog.events.KeyCodes.RIGHT;var c=l[e.keyCode];e.keyCode=c||e.keyCode}return Blockly.Toolbox.TreeNode.superClass_.onKeyDown.call(this,e)}},t.removeSearch=function(){var e=document.getElementById("blocklySearchArea");e&&e.parentNode.removeChild(e)},t.cleanBlocks=function(){e.debug("removing all custom blocks");for(var t in oe)C(oe[t].fn)};var se=!1;t.onShowContextMenu=void 0,t.getNamespaceColor=H,t.initFlyouts=function(e){e.registerToolboxCategoryCallback(Blockly.VARIABLE_CATEGORY_NAME,Blockly.Variables.flyoutCategory),e.registerToolboxCategoryCallback(Blockly.PROCEDURE_CATEGORY_NAME,Blockly.Procedures.flyoutCategory)},t.initExtensions=function(e,t,o){t.forEach(function(t){var i=t.name;e.registerButtonCallback("EXT"+i+"_BUTTON",function(e){o(i)})})};var ce={}}(e.blocks||(e.blocks={}))}(pxt||(pxt={}));var pxt;!function(e){!function(t){var o;!function(e){e.ObjectDestructuringMutator="objectdestructuring",e.RestParameterMutator="restparameter",e.DefaultInstanceMutator="defaultinstance"}(o=t.MutatorTypes||(t.MutatorTypes={})),t.addMutation=function(e,t,i){var a;switch(i){case o.ObjectDestructuringMutator:if(!t.parameters||t.parameters.length<1)console.error("Destructuring mutations require at least one parameter");else{for(var s=!1,c=0,u=t.parameters;c<u.length;c++){var p=u[c];if(-1!==p.type.indexOf("=>")){if(!p.properties||0===p.properties.length)return void console.error("Destructuring mutations only supported for functions with an event parameter that has multiple properties");s=!0}}if(!s)return void console.error("Destructuring mutations must have an event parameter")}a=new r(e,t);break;case o.RestParameterMutator:a=new n(e,t);break;case o.DefaultInstanceMutator:a=new l(e,t);break;default:return void console.warn("Ignoring unknown mutation type: "+i)}e.mutationToDom=a.mutationToDom.bind(a),e.domToMutation=a.domToMutation.bind(a),e.compose=a.compose.bind(a),e.decompose=a.decompose.bind(a),e.mutation=a},t.mutateToolboxBlock=function(e,t,i){var a=document.createElement("mutation");switch(t){case o.ObjectDestructuringMutator:a.setAttribute(r.propertiesAttributeName,i);break;case o.RestParameterMutator:a.setAttribute(n.countAttributeName,i);break;case o.DefaultInstanceMutator:a.setAttribute(l.attributeName,i);default:return void console.warn("Ignoring unknown mutation type: "+t)}e.appendChild(a)};var i=function(){function e(e,t){this.info=t,this.block=e,this.topBlockType=this.block.type+"_mutator";var o=this.getSubBlockNames();this.initializeMutatorTopBlock(),this.initializeMutatorSubBlocks(o);var i=o.map(function(e){return e.type});this.block.setMutator(new Blockly.Mutator(i))}return e.prototype.compose=function(e){var t=e.getDescendants().map(function(e){return{type:e.type,name:e.inputList[0].name}});t.shift(),this.updateBlock(t)},e.prototype.decompose=function(t){var o=t.newBlock(this.topBlockType);o.initSvg();for(var i=this,r=0,n=o.inputList;r<n.length&&"break"!==function(o){if(o.name===e.mutatorStatmentInput){var r=o.connection;return i.getVisibleBlockTypes().forEach(function(e){var o=t.newBlock(e);o.initSvg(),r.connect(o.previousConnection),r=o.nextConnection}),"break"}}(n[r]);r++);return o},e.prototype.compileMutation=function(e,t){},e.prototype.getDeclaredVariables=function(){},e.prototype.isDeclaredByMutation=function(e){return!1},e.prototype.initializeMutatorSubBlock=function(e,t,o){e.appendDummyInput(t).appendField(t),e.setColour(o),e.setNextStatement(!0),e.setPreviousStatement(!0)},e.prototype.initializeMutatorTopBlock=function(){var t=this.info.attributes.mutateText,o=this.block.getColour();Blockly.Blocks[this.topBlockType]=Blockly.Blocks[this.topBlockType]||{init:function(){var i=this;i.appendDummyInput().appendField(t),i.setColour(o),i.appendStatementInput(e.mutatorStatmentInput)}}},e.prototype.initializeMutatorSubBlocks=function(e){var t=this.block.getColour(),o=this.initializeMutatorSubBlock.bind(this);e.forEach(function(e){Blockly.Blocks[e.type]=Blockly.Blocks[e.type]||{init:function(){o(this,e.name,t)}}})},e.mutatorStatmentInput="PROPERTIES",e.mutatedVariableInputName="properties",e}(),r=function(r){function n(e,t){r.call(this,e,t),this.currentlyVisible=[],this.parameterRenames={},this.prefix=this.info.attributes.mutatePrefix,this.block.appendDummyInput(i.mutatedVariableInputName),this.block.appendStatementInput("HANDLER").setCheck("null")}return __extends(n,r),n.prototype.getMutationType=function(){return o.ObjectDestructuringMutator},n.prototype.compileMutation=function(e,o){var i=this;if(this.info.attributes.mutatePropertyEnum||this.parameters.length){var r="function ({ "+this.parameters.map(function(o){var r=i.block.getFieldValue(o),n=t.escapeVarName(o,e);return r!==o?(i.parameterRenames[o]=r,o+": "+t.escapeVarName(r,e)):n}).join(", ")+" })";return this.info.attributes.mutatePropertyEnum?t.mkText(" ["+this.parameters.map(function(e){return i.info.attributes.mutatePropertyEnum+"."+e}).join(", ")+"],"+r):t.mkText(r)}},n.prototype.getDeclaredVariables=function(){var e=this,t={};return this.parameters.forEach(function(o){t[e.block.getFieldValue(o)]=e.parameterTypes[o]}),t},n.prototype.isDeclaredByMutation=function(e){var t=this;return this.parameters.some(function(o){return t.block.getFieldValue(o)===e})},n.prototype.mutationToDom=function(){var t=this,o=document.createElement("mutation"),i=this.parameters.map(function(o){var i=t.block.getFieldValue(o);return i!==o&&(t.parameterRenames[o]=e.Util.htmlEscape(i)),e.Util.htmlEscape(o)}).join(",");o.setAttribute(n.propertiesAttributeName,i);for(var r in this.parameterRenames)r===this.parameterRenames[r]&&delete this.parameterRenames[r];return o.setAttribute(n.renameAttributeName,JSON.stringify(this.parameterRenames)),o},n.prototype.domToMutation=function(e){var t=this,o=e.getAttribute(n.propertiesAttributeName);if(o){var i=o.split(","),r=[];if(void 0===this.paramIndex&&(this.paramIndex=this.getParameterIndex()),i.forEach(function(e){var o=e.split(":");t.info.parameters[t.paramIndex].properties.some(function(e){return e.name===o[0]})&&r.push({property:o[0],newName:o[1]})}),this.parameterRenames=void 0,e.hasAttribute(n.renameAttributeName))try{this.parameterRenames=JSON.parse(e.getAttribute(n.renameAttributeName))}catch(e){console.warn("Ignoring invalid rename map in saved block mutation")}this.parameterRenames=this.parameterRenames||{},this.parameters=[],r.forEach(function(e){t.parameters.push(e.property),e.newName&&e.newName!==e.property&&(t.parameterRenames[e.property],e.newName)}),this.updateVisibleProperties(),r.filter(function(e){return!!e.newName}).forEach(function(e){return t.block.setFieldValue(e.newName,e.property)})}},n.prototype.updateBlock=function(e){var t=this;this.parameters=[],e.forEach(function(e){-1===t.parameters.indexOf(e.name)&&t.parameters.push(e.name)}),this.updateVisibleProperties()},n.prototype.getSubBlockNames=function(){var e=this;return this.parameters=[],this.parameterTypes={},void 0===this.paramIndex&&(this.paramIndex=this.getParameterIndex()),this.info.parameters[this.paramIndex].properties.map(function(t){return e.parameterTypes[t.name]=t.type,{type:e.propertyId(t.name),name:t.name}})},n.prototype.getVisibleBlockTypes=function(){var e=this;return this.currentlyVisible.map(function(t){return e.propertyId(t)})},n.prototype.updateVisibleProperties=function(){var t=this;if(!e.Util.listsEqual(this.currentlyVisible,this.parameters)){var o=this.block.inputList.filter(function(e){return e.name===i.mutatedVariableInputName})[0];this.prefix&&0===this.currentlyVisible.length&&o.appendField(this.prefix,n.prefixLabel),this.currentlyVisible.forEach(function(e){if(-1===t.parameters.indexOf(e)){var i=t.block.getFieldValue(e);i!==e&&(t.parameterRenames[e]=i),o.removeField(e)}}),this.parameters.forEach(function(e){if(-1===t.currentlyVisible.indexOf(e)){var i=t.parameterRenames[e]||e;o.appendField(new Blockly.FieldVariable(i),e)}}),this.prefix&&0===this.parameters.length&&o.removeField(n.prefixLabel),this.currentlyVisible=this.parameters}},n.prototype.propertyId=function(e){return this.block.type+"_"+e},n.prototype.getParameterIndex=function(){for(var e=0;e<this.info.parameters.length;e++)if(-1!==this.info.parameters[e].type.indexOf("=>"))return e},n.propertiesAttributeName="callbackproperties",n.renameAttributeName="renamemap",n.prefixLabel="0prefix_label_",n}(i),n=function(e){function i(){e.apply(this,arguments),this.count=0}return __extends(i,e),i.prototype.getMutationType=function(){return o.RestParameterMutator},i.prototype.compileMutation=function(e,o){var i=[];return this.forEachInput(function(r){return i.push(t.compileExpression(e,r,o))}),t.mkGroup(i)},i.prototype.mutationToDom=function(){var e=document.createElement("mutation");return e.setAttribute(i.countAttributeName,this.count.toString()),e},i.prototype.domToMutation=function(e){var t=e.getAttribute(i.countAttributeName);if(t){try{this.count=parseInt(t)}catch(e){return}for(var o=0;o<this.count;o++)this.addNumberField(!1,o)}},i.prototype.updateBlock=function(e){if(e){var t=Math.abs(this.count-e.length);if(this.count<e.length)for(o=0;o<t;o++)this.addNumberField(!0,this.count);else if(this.count>e.length)for(var o=0;o<t;o++)this.removeNumberField()}},i.prototype.getSubBlockNames=function(){return[{name:"Value",type:i.entryTypeName}]},i.prototype.getVisibleBlockTypes=function(){var e=[];return this.forEachInput(function(){return e.push(i.entryTypeName)}),e},i.prototype.addNumberField=function(e,t){var o=this.block.appendValueInput(i.valueInputPrefix+t).setCheck("Number");if(e){var r=this.block.workspace.newBlock("math_number");r.initSvg(),r.setShadow(!0),o.connection.connect(r.outputConnection),this.block.workspace.render(),this.count++}},i.prototype.removeNumberField=function(){this.count>0&&this.block.removeInput(i.valueInputPrefix+(this.count-1)),this.count--},i.prototype.forEachInput=function(e){for(var t=0;t<this.count;t++)e(this.block.getInputTargetBlock(i.valueInputPrefix+t),t)},i.countAttributeName="count",i.entryTypeName="entry",i.valueInputPrefix="value_input_",i}(i),l=function(e){function i(){e.apply(this,arguments),this.showing=!1}return __extends(i,e),i.prototype.getMutationType=function(){return o.DefaultInstanceMutator},i.prototype.compileMutation=function(e,o){if(this.showing){var r=this.block.getInputTargetBlock(i.instanceInputName);if(r)return t.compileExpression(e,r,o)}},i.prototype.mutationToDom=function(){var e=document.createElement("mutation");return e.setAttribute(i.attributeName,this.showing?"true":"false"),e},i.prototype.domToMutation=function(e){var t=e.getAttribute(i.attributeName);t?this.updateShape("true"===t):this.updateShape(!1)},i.prototype.updateBlock=function(e){this.updateShape(!(!e||!e.length))},i.prototype.getSubBlockNames=function(){return[{name:"Instance",type:i.instanceSubBlockType}]},i.prototype.getVisibleBlockTypes=function(){var e=[];return this.showing&&e.push(i.instanceSubBlockType),e},i.prototype.updateShape=function(e){this.showing!==e&&(e&&!this.block.getInputTargetBlock(i.instanceInputName)?this.block.appendValueInput(i.instanceInputName):this.block.removeInput(i.instanceInputName),this.showing=e)},i.attributeName="showing",i.instanceInputName="__instance__",i.instanceSubBlockType="instance",i}(i)}(e.blocks||(e.blocks={}))}(pxt||(pxt={}));var pxt;!function(e){!function(t){var o,i;!function(e){e[e.Align=1]="Align",e[e.Clean=3]="Clean",e[e.Flow=4]="Flow"}(t.BlockLayout||(t.BlockLayout={}));var r=t.BlockLayout;t.render=function(t,n){void 0===n&&(n={emPixels:14,layout:r.Flow}),o||((i=document.createElement("div")).style.position="absolute",i.style.top="0",i.style.left="0",i.style.width="1px",i.style.height="1px",document.body.appendChild(i),o=Blockly.inject(i,{scrollbars:!1,readOnly:!0,zoom:!1,sound:!1,media:e.webConfig.commitCdnUrl+"blockly/media/",rtl:e.Util.isUserLanguageRtl()})),o.clear();try{var l=t||'<xml xmlns="http://www.w3.org/1999/xhtml"></xml>',a=Blockly.Xml.textToDom(l);switch(Blockly.Xml.domToWorkspace(a,o),n.layout){case r.Align:e.blocks.layout.verticalAlign(o,n.emPixels);break;case r.Flow:e.blocks.layout.flow(o,{ratio:n.aspectRatio,useViewWidth:n.useViewWidth});break;case r.Clean:o.cleanUp_&&o.cleanUp_()}var s=o.getMetrics(),c=$(i).find("svg").clone(!0,!0);return c.removeClass("blocklySvg").addClass("blocklyPreview"),c.find(".blocklyBlockCanvas,.blocklyBubbleCanvas").attr("transform","translate("+-s.contentLeft+", "+-s.contentTop+") scale(1)"),c.find(".blocklyMainBackground").remove(),c[0].setAttribute("viewBox","0 0 "+s.contentWidth+" "+s.contentHeight),c.removeAttr("width"),c.removeAttr("height"),n.emPixels&&(c[0].style.width=s.contentWidth/n.emPixels+"em",c[0].style.height=s.contentHeight/n.emPixels+"em"),c[0]}catch(t){return void e.reportException(t)}},t.blocksMetrics=function(e){var t=e.getTopBlocks(!1);if(!t.length)return{width:0,height:0};var o=void 0;return t.forEach(function(e){var t=e.getBoundingRectangle();o?(o.l=Math.min(o.l,t.topLeft.x),o.r=Math.max(o.r,t.bottomRight.y),o.t=Math.min(o.t,t.topLeft.y),o.b=Math.min(o.b,t.bottomRight.y)):o={l:t.topLeft.x,r:t.bottomRight.x,t:t.topLeft.y,b:t.bottomRight.y}}),{width:o.r-o.l,height:o.b-o.t}}}(e.blocks||(e.blocks={}))}(pxt||(pxt={}));var pxt;!function(e){!function(t){!function(t){e.Util.repeatMap;t.render=function(t,o){void 0===o&&(o={});var i=e.Util.repeatMap,r=t.color||"";r||(t.hardware&&!t.software?r="black":t.software&&!t.hardware&&(r="teal"));var n=t.url?/^[^:]+:\/\//.test(t.url)?t.url:"/"+t.url.replace(/^\.?\/?/,""):void 0,l=!!n,a=function(e,t,o,i){void 0===o&&(o="div"),void 0===i&&(i="");var r=document.createElement(o);return t&&(r.className=t),e&&e.appendChild(r),i&&r.appendChild(document.createTextNode(i+"")),r},s=a(null,"ui card "+(t.color||"")+(l?" link":""),l?"a":"div");if(s.setAttribute("role","option"),s.setAttribute("aria-selected","true"),n&&(s.href=n),!o.hideHeader&&(t.header||t.blocks||t.javascript||t.hardware||t.software||t.any)){var c=a(s,"ui content "+(t.responsive?" tall desktop only":"")),u=a(c,"right floated meta");t.any&&a(u,"ui grey circular label tiny","i",t.any>0?t.any:""),i(t.blocks,function(e){return a(u,"puzzle orange icon","i")}),i(t.javascript,function(e){return a(u,"align left blue icon","i")}),i(t.hardware,function(e){return a(u,"certificate black icon","i")}),i(t.software,function(e){return a(u,"square teal icon","i")}),t.header&&a(c,"description","span",t.header)}var p=(o.shortName?t.shortName:"")||t.name,d=a(s,"ui image"+(t.responsive?" tall landscape only":""));if(t.label){var h=document.createElement("label");h.className="ui "+(t.labelClass?t.labelClass:"orange right ribbon")+" label",h.textContent=t.label,d.appendChild(h)}if(t.blocksXml){var m=e.blocks.render(t.blocksXml);if(m){var f=a(d,"");f.setAttribute("style","width:100%; min-height:10em"),f.appendChild(m)}else console.error("failed to render blocks"),e.debug(t.blocksXml)}if(t.typeScript){var g=document.createElement("pre");g.appendChild(document.createTextNode(t.typeScript)),d.appendChild(g)}if(t.imageUrl){var b=document.createElement("div");b.className="ui imagewrapper";var k=document.createElement("img");k.className="ui cardimage",k.src=t.imageUrl,k.alt=p,k.setAttribute("role","presentation"),b.appendChild(k),d.appendChild(b)}if(t.youTubeId){var y=document.createElement("img");y.className="ui image",y.src="https://img.youtube.com/vi/"+t.youTubeId+"/maxresdefault.jpg",d.appendChild(y)}if("file"==t.cardType){var v=a(s,"ui fileimage");d.appendChild(v)}if(p||t.description){var _=a(s,"ui content");p&&(s.setAttribute("aria-label",p),n&&!l?function(e,t,o,i){var r=document.createElement("a");r.className=i,r.href=t,r.appendChild(document.createTextNode(o)),r.target="_blank",e.appendChild(r)}(_,n,p,"header"):a(_,"header","div",p)),t.description&&a(_,"ui description").appendChild(document.createTextNode(t.description.split(".")[0]+"."))}if(t.time){var T=a(s,"meta");t.time&&a(T,"date","span").appendChild(document.createTextNode(e.Util.timeSince(t.time)))}return t.extracontent&&a(s,"extra content","div").appendChild(document.createTextNode(t.extracontent)),s}}(t.codeCard||(t.codeCard={}))}(e.docs||(e.docs={}))}(pxt||(pxt={}));var pxtblockly;!function(e){var t=function(e){function t(t,o,i){e.call(this,String(t),"0","255",null,"10","Color",i),this.isFieldCustom_=!0,this.params=o,this.params.min&&(this.min_=parseFloat(this.params.min)),this.params.max&&(this.max_=parseFloat(this.params.max)),this.params.label&&(this.labelText_=this.params.label),this.params.channel&&(this.channel_=this.params.channel)}return __extends(t,e),t.prototype.setBackground_=function(e){var t=this.createColourStops_().join(",");goog.style.setStyle(e,"background","-moz-linear-gradient(left, "+t+")"),goog.style.setStyle(e,"background","-webkit-linear-gradient(left, "+t+")"),goog.style.setStyle(e,"background","-o-linear-gradient(left, "+t+")"),goog.style.setStyle(e,"background","-ms-linear-gradient(left, "+t+")"),goog.style.setStyle(e,"background","linear-gradient(left, "+t+")"),this.params.sliderWidth&&goog.style.setStyle(e,"width",this.params.sliderWidth+"px")},t.prototype.setReadout_=function(e,t){var o=this.colorWheel(parseInt(t),this.channel_);e.innerHTML='<span class="blocklyColorReadout" style="background-color: '+o+';"></span>'},t.prototype.createColourStops_=function(){for(var e=[],t=0;t<=255;t+=20)e.push(this.colorWheel(t,this.channel_));return e},t.prototype.colorWheel=function(e,t){return"hsvfast"==t?this.hsvFast(e,255,255):(e=255-e)<85?this.hex(3*e,255,255-3*e):e<170?(e-=85,this.hex(255,255-3*e,3*e)):(e-=170,this.hex(255-3*e,3*e,255))},t.prototype.hsvFast=function(e,t,o){var i=e%255>>0;i<0&&(i+=255);var r,n,l,a=o*(255-t)/255>>0,s=o-a,c=(i=192*i/255>>0)/64>>0,u=i%64>>0,p=(u*s/63.75>>0)+a,d=((63-u)*s/63.75>>0)+a;return c?1==c?(r=a,n=d,l=p):(r=p,n=a,l=d):(r=d,n=p,l=a),this.hex(r,n,l)},t.prototype.hex=function(e,t,o){return"#"+this.componentToHex(255&e)+this.componentToHex(255&t)+this.componentToHex(255&o)},t.prototype.componentToHex=function(e){var t=e.toString(16);return 1==t.length?"0"+t:t},t}(Blockly.FieldSlider);e.FieldColorWheel=t}(pxtblockly||(pxtblockly={}));var pxtblockly;!function(e){var t=function(e){function t(t,o,i){e.call(this,t,i),this.isFieldCustom_=!0,o.colours&&this.setColours(JSON.parse(o.colours)),o.columns&&this.setColumns(parseInt(o.columns)),o.className&&(this.className_=o.className)}return __extends(t,e),t.prototype.getValue=function(e){return!e&&this.colour_.indexOf("#")>-1?"0x"+this.colour_.replace(/^#/,""):this.colour_},t.prototype.setValue=function(e){e.indexOf("0x")>-1&&(e="#"+e.substr(2)),this.sourceBlock_&&Blockly.Events.isEnabled()&&this.colour_!=e&&Blockly.Events.fire(new Blockly.Events.BlockChange(this.sourceBlock_,"field",this.name,this.colour_,e)),this.colour_=e,this.sourceBlock_&&this.sourceBlock_.setColour(e,e,e)},t.prototype.showEditor_=function(){e.prototype.showEditor_.call(this),this.className_&&this.colorPicker_&&Blockly.utils.addClass(this.colorPicker_.getElement(),this.className_)},t}(Blockly.FieldColour);e.FieldColorNumber=t}(pxtblockly||(pxtblockly={}));var pxtblockly;!function(e){var t=function(t){function o(o,i,r){t.call(this,i.data),this.isFieldCustom_=!0,this.tooltips_=[],this.columns_=parseInt(i.columns)||4,this.maxRows_=parseInt(i.maxRows)||0,this.width_=parseInt(i.width)||400,this.backgroundColour_=e.parseColour(i.colour),this.itemColour_=i.itemColour||"rgba(255, 255, 255, 0.6)",this.borderColour_=Blockly.PXTUtils.fadeColour(this.backgroundColour_,.4,!1);var n={xOffset:parseInt(i.tooltipsXOffset)||15,yOffset:parseInt(i.tooltipsYOffset)||-10};this.tooltipConfig_=n,this.hasSearchBar_=!!i.hasSearchBar||!1,this.hideRect_=!!i.hideRect||!1}return __extends(o,t),o.prototype.dispose=function(){t.prototype.dispose.call(this),this.disposeTooltips()},o.prototype.populateTableContainer=function(e,t){this.disposeTooltips(),t.removeChildren(!0),0==e.length&&(this.firstItem_=void 0);for(n=0;n<e.length/this.columns_;n++){var o=this.createRow(n,e);t.addChild(o,!0)}var i=t.getElement();if(i)for(var r=i.childNodes,n=0;n<r.length;++n)r[n].className="blocklyGridPickerRow"},o.prototype.createTooltips=function(e,t){for(var o=this,i=e.length<this.columns_,r=t.getElement().getElementsByClassName("goog-menuitem"),n=-1,l=this,a=0;a<r.length;++a)!function(t){var a=r[t];a.style.borderColor=l.backgroundColour_,a.style.backgroundColor=l.itemColour_,i&&(a.className+=" floatLeft");var s=e[t][0].alt;if(s){var c=new goog.ui.Tooltip(a,s),u=c.onShow;c.onShow=function(){u.call(c);var e=new goog.positioning.ClientPosition(c.cursorPosition.x+o.tooltipConfig_.xOffset,c.cursorPosition.y+o.tooltipConfig_.yOffset);c.setPosition(e)},c.setShowDelayMs(0),c.className="goog-tooltip blocklyGridPickerTooltip",a.addEventListener("mousemove",function(e){var t=new goog.positioning.ClientPosition(e.clientX+o.tooltipConfig_.xOffset,e.clientY+o.tooltipConfig_.yOffset);c.setPosition(t)}),l.tooltips_.push(c)}else{var p=goog.style.getSize(a).width;p>n&&(n=p)}}(a);if(n>-1)for(a=0;a<r.length;++a){var s=r[a];goog.style.setWidth(s,n)}},o.prototype.shouldShowRect_=function(){return!this.hideRect_&&!this.sourceBlock_.isShadow()},o.prototype.selectItem=function(e){this.menu_&&(this.onItemSelected(this.menu_,e),this.close())},o.prototype.close=function(){Blockly.WidgetDiv.hideIfOwner(this),Blockly.Events.setGroup(!1),this.disposeTooltips()},o.prototype.getFirstItem=function(){return this.firstItem_},o.prototype.highlightFirstItem=function(e){var t=e.childNodes;if(t.length&&t[0].childNodes){for(var o=0;o<t.length;++o)for(var i=t[o].childNodes.length,r=0;r<i;++r){var n=t[o].childNodes[r];n.classList.remove("goog-menuitem-highlight"),n.classList.remove("goog-option-selected")}t[0].childNodes[0].className+=" goog-menuitem-highlight"}},o.prototype.highlightAndScrollSelected=function(e,t){for(var o,i=e.getElement(),r=e.getChildCount(),n=0;n<r;++n){for(var l=0;l<this.columns_;++l){var a=e.getChildAt(n).getChildAt(l).getValue();if(this.value_===a){o=i.children[n].children[l];break}}if(o){goog.style.scrollIntoContainerView(o,t,!0);break}}},o.prototype.showEditor_=function(){var e=this;Blockly.WidgetDiv.show(this,this.sourceBlock_.RTL,null),this.disposeTooltips();var t=this.getOptions(),o=new goog.ui.Control;this.populateTableContainer(t,o);var i=new goog.ui.Control,r=new goog.ui.Control,n=goog.dom.getViewportSize(),l=goog.style.getViewportPageOffset(document),a=this.getAbsoluteXY_(),s=this.getScaledBBox_(),c=Blockly.WidgetDiv.DIV;i.addChild(o,!0),r.addChild(i,!0),r.render(c);var u=r.getElement(),p=i.getElement(),d=o.getElement();if(this.hasSearchBar_){var h=document.createElement("div");h.setAttribute("class","ui fluid icon input");var m=document.createElement("i");m.setAttribute("class","search icon");var f=document.createElement("input");f.setAttribute("type","search"),f.setAttribute("id","search-bar"),f.setAttribute("class","blocklyGridPickerSearchBar"),f.setAttribute("placeholder",pxt.Util.lf("Search")),f.addEventListener("click",function(){f.focus(),f.setSelectionRange(0,f.value.length)}),f.addEventListener("keyup",Util.debounce(function(){var i=f.value,r=new RegExp(i,"i"),n=t.filter(function(e){var t=e[0].alt,o=e[1];return t?r.test(t):r.test(o)});e.populateTableContainer.bind(e)(n,o),e.createTooltips(n,o),i?e.highlightFirstItem(d):e.highlightAndScrollSelected(o,p)},300,!1)),f.addEventListener("keyup",function(t){if(13==t.keyCode){var o=f.value,i=e.getFirstItem();o&&i&&e.selectItem(i)}}),h.appendChild(f),h.appendChild(m),u.insertBefore(h,u.childNodes[0]),f.focus()}u.style.border="solid 1px "+this.borderColour_,this.width_>n.width&&(this.width_=n.width),d.style.width=this.width_+"px",d.style.backgroundColor=this.backgroundColour_,p.style.backgroundColor=this.backgroundColour_,u.style.backgroundColor=this.backgroundColour_,d.className="blocklyGridPickerMenu",p.className="blocklyGridPickerScroller",u.className="blocklyGridPickerPadder",this.createTooltips(t,o);var g=goog.style.getSize(u),b=goog.style.getSize(p);if(b.height=p.scrollHeight,b.width=p.scrollWidth,g.height=u.scrollHeight,g.width=u.scrollWidth,this.maxRows_>0){var k=d.children[0],y=goog.style.getSize(k).height*(this.maxRows_+.3);if(b.height>y){p.style.overflowY="auto",goog.style.setHeight(p,y);var v=goog.style.getPaddingBox(p),_=v.left+v.right,T=goog.style.getMarginBox(p),x=T.left+T.right,E=goog.style.getBorderBox(p),B=_+x+(E.left+E.right),A=p.offsetWidth-p.clientWidth-B;goog.style.setWidth(p,b.width+A),g.height=u.scrollHeight,g.width=u.scrollWidth,this.highlightAndScrollSelected(o,p)}}a.y+g.height+s.height>=n.height+l.y?a.y-=g.height+2:a.y+=s.height,this.sourceBlock_.RTL?(a.x+=g.width/2-s.width/2,a.x<l.x+g.width&&(a.x=l.x+g.width)):(a.x+=s.width/2-g.width/2,a.x>n.width+l.x-g.width&&(a.x=n.width+l.x-g.width)),Blockly.WidgetDiv.position(a.x,a.y,n,l,this.sourceBlock_.RTL),goog.style.setHeight(c,"auto")},o.prototype.createRow=function(e,t){var o=this,i=this.columns_,r=new goog.ui.Menu;r.setRightToLeft(this.sourceBlock_.RTL);for(var n=i*e;n<Math.min(i*e+i,t.length);n++){var l=t[n][0],a=t[n][1];if("object"==typeof l){var s=new Image(l.width,l.height);s.src=l.src,s.alt=l.alt||"",l=s}var c=new goog.ui.MenuItem(l);c.setRightToLeft(this.sourceBlock_.RTL),c.setValue(a),c.setCheckable(!0),c.setChecked(a==this.value_),r.addChild(c,!0),0==n&&(this.firstItem_=c)}return goog.events.listen(r,goog.ui.Component.EventType.ACTION,function(e){var t=e.target;t&&o.selectItem.bind(o)(t)}),this.menu_=r,r},o.prototype.disposeTooltips=function(){this.tooltips_&&this.tooltips_.length&&(this.tooltips_.forEach(function(e){return e.dispose()}),this.tooltips_=[])},o.prototype.setText=function(e){null!==e&&e!==this.text_&&(this.text_=e,this.updateTextNode_(),this.imageJson_&&this.textElement_?(this.textElement_.setAttribute("class",this.textElement_.getAttribute("class")+" blocklyHidden"),this.imageElement_.parentNode.appendChild(this.arrow_)):this.textElement_&&(this.textElement_.setAttribute("class",this.textElement_.getAttribute("class")+" blocklyDropdownText"),this.textElement_.parentNode.appendChild(this.arrow_)),this.sourceBlock_&&this.sourceBlock_.rendered&&(this.sourceBlock_.render(),this.sourceBlock_.bumpNeighbours_()))},o.prototype.updateWidth=function(){var e;this.imageJson_?(e=this.imageJson_.width+5,this.arrowY_=this.imageJson_.height/2):e=Blockly.Field.getCachedWidth(this.textElement_),this.EDITABLE&&(e+=Blockly.BlockSvg.EDITABLE_FIELD_PADDING),this.arrowWidth_=0,this.positionArrow&&(this.arrowWidth_=this.positionArrow(e),e+=this.arrowWidth_),this.box_&&(e+=2*Blockly.BlockSvg.BOX_FIELD_PADDING),this.size_.width=e},o.prototype.updateTextNode_=function(){if(this.textElement_||this.imageElement_){var e=this.text_;if(e.length>this.maxDisplayLength?(e=e.substring(0,this.maxDisplayLength-2)+"â€¦",this.textElement_.setAttribute("class","blocklyText blocklyTextTruncated")):this.textElement_.setAttribute("class","blocklyText"),goog.dom.removeChildren(this.textElement_),goog.dom.removeNode(this.imageElement_),this.imageElement_=null,this.imageJson_)this.imageElement_=Blockly.utils.createSvgElement("image",{y:5,x:8,height:this.imageJson_.height+"px",width:this.imageJson_.width+"px",cursor:"pointer"}),this.imageElement_.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",this.imageJson_.src),this.size_.height=Number(this.imageJson_.height)+10,this.textElement_.parentNode.appendChild(this.imageElement_);else{e=e.replace(/\s/g,Blockly.Field.NBSP),this.sourceBlock_.RTL&&e&&(e+="â€"),e||(e=Blockly.Field.NBSP);var t=document.createTextNode(e);this.textElement_.appendChild(t)}this.size_.width=0}},o}(Blockly.FieldDropdown);e.FieldGridPicker=t}(pxtblockly||(pxtblockly={}));var pxtblockly;!function(e){var t=function(t){function o(o,i,r){t.call(this,i.data),this.isFieldCustom_=!0,this.buttonClick_=function(e){var t=e.target.getAttribute("data-value");this.setValue(t),Blockly.DropDownDiv.hide()},this.onHide_=function(){Blockly.DropDownDiv.content_.removeAttribute("role"),Blockly.DropDownDiv.content_.removeAttribute("aria-haspopup"),Blockly.DropDownDiv.content_.removeAttribute("aria-activedescendant")},this.columns_=parseInt(i.columns),this.maxRows_=parseInt(i.maxRows)||0,this.width_=parseInt(i.width)||300,this.backgroundColour_=e.parseColour(i.colour),this.itemColour_=i.itemColour||"rgba(255, 255, 255, 0.6)",this.borderColour_=Blockly.PXTUtils.fadeColour(this.backgroundColour_,.4,!1)}return __extends(o,t),o.prototype.showEditor_=function(){if(!Blockly.DropDownDiv.hideIfOwner(this)){Blockly.DropDownDiv.hideWithoutAnimation(),Blockly.DropDownDiv.clearContent();var e=Blockly.DropDownDiv.getContentDiv(),t=document.createElement("div");t.setAttribute("role","menu"),t.setAttribute("aria-haspopup","true");for(var o=this.getOptions(),i=0;o[i];i++){var r=o[i][0],n=o[i][1];if("placeholder"!=r.type){var l=document.createElement("button");l.setAttribute("id",":"+i),l.setAttribute("role","menuitem"),l.setAttribute("class","blocklyDropDownButton"),l.title=r.alt,this.columns_?(l.style.width=this.width_/this.columns_-8+"px",l.style.height=this.width_/this.columns_-8+"px"):(l.style.width=r.width+"px",l.style.height=r.height+"px");var a=this.backgroundColour_;n==this.getValue()&&(a=this.sourceBlock_.getColourTertiary(),l.setAttribute("aria-selected","true")),l.style.backgroundColor=a,l.style.borderColor=this.borderColour_,Blockly.bindEvent_(l,"click",this,this.buttonClick_),Blockly.bindEvent_(l,"mouseup",this,this.buttonClick_),Blockly.bindEvent_(l,"mousedown",l,function(e){this.setAttribute("class","blocklyDropDownButton blocklyDropDownButtonHover"),e.preventDefault()}),Blockly.bindEvent_(l,"mouseover",l,function(){this.setAttribute("class","blocklyDropDownButton blocklyDropDownButtonHover"),t.setAttribute("aria-activedescendant",this.id)}),Blockly.bindEvent_(l,"mouseout",l,function(){this.setAttribute("class","blocklyDropDownButton"),t.removeAttribute("aria-activedescendant")});var s=document.createElement("img");s.src=r.src,l.setAttribute("data-value",n),s.setAttribute("data-value",n),l.appendChild(s),t.appendChild(l)}else{var c=document.createElement("span");c.setAttribute("class","blocklyDropDownPlaceholder"),c.style.width=r.width+"px",c.style.height=r.height+"px",t.appendChild(c)}}t.style.width=this.width_+"px",e.appendChild(t),Blockly.DropDownDiv.setColour(this.backgroundColour_,this.borderColour_);var u=this.sourceBlock_.workspace.scale,p=-Blockly.BlockSvg.MIN_BLOCK_Y*u-Blockly.BlockSvg.FIELD_Y_OFFSET*u;Blockly.DropDownDiv.showPositionedByBlock(this,this.sourceBlock_,this.onHide_.bind(this),p)}},o.prototype.setText=function(e){null!==e&&e!==this.text_&&(this.text_=e,this.updateTextNode_(),this.imageJson_&&this.textElement_?(this.textElement_.setAttribute("class",this.textElement_.getAttribute("class")+" blocklyHidden"),this.imageElement_.parentNode.appendChild(this.arrow_)):this.textElement_&&(this.textElement_.setAttribute("class",this.textElement_.getAttribute("class")+" blocklyDropdownText"),this.textElement_.parentNode.appendChild(this.arrow_)),this.sourceBlock_&&this.sourceBlock_.rendered&&(this.sourceBlock_.render(),this.sourceBlock_.bumpNeighbours_()))},o.prototype.updateWidth=function(){var e=this.imageJson_.width+5;this.EDITABLE&&(e+=Blockly.BlockSvg.EDITABLE_FIELD_PADDING),this.arrowY_=this.imageJson_.height/2,this.arrowWidth_=0,this.positionArrow&&(this.arrowWidth_=this.positionArrow(e),e+=this.arrowWidth_),this.box_&&(e+=2*Blockly.BlockSvg.BOX_FIELD_PADDING),this.size_.width=e},o.prototype.updateTextNode_=function(){if(this.textElement_||this.imageElement_){var e=this.text_;if(e.length>this.maxDisplayLength?(e=e.substring(0,this.maxDisplayLength-2)+"â€¦",this.textElement_.setAttribute("class","blocklyText blocklyTextTruncated")):this.textElement_.setAttribute("class","blocklyText"),goog.dom.removeChildren(this.textElement_),goog.dom.removeNode(this.imageElement_),this.imageElement_=null,this.imageJson_)this.imageElement_=Blockly.utils.createSvgElement("image",{y:5,x:8,height:this.imageJson_.height+"px",width:this.imageJson_.width+"px"}),this.imageElement_.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",this.imageJson_.src),this.size_.height=Number(this.imageJson_.height)+10,this.textElement_.parentNode.appendChild(this.imageElement_);else{e=e.replace(/\s/g,Blockly.Field.NBSP),this.sourceBlock_.RTL&&e&&(e+="â€"),e||(e=Blockly.Field.NBSP);var t=document.createTextNode(e);this.textElement_.appendChild(t)}this.size_.width=0}},o}(Blockly.FieldDropdown);e.FieldImageDropdown=t}(pxtblockly||(pxtblockly={}));var pxtblockly;!function(e){var t;!function(e){e[e.C=262]="C",e[e.CSharp=277]="CSharp",e[e.D=294]="D",e[e.Eb=311]="Eb",e[e.E=330]="E",e[e.F=349]="F",e[e.FSharp=370]="FSharp",e[e.G=392]="G",e[e.GSharp=415]="GSharp",e[e.A=440]="A",e[e.Bb=466]="Bb",e[e.B=494]="B",e[e.C3=131]="C3",e[e.CSharp3=139]="CSharp3",e[e.D3=147]="D3",e[e.Eb3=156]="Eb3",e[e.E3=165]="E3",e[e.F3=175]="F3",e[e.FSharp3=185]="FSharp3",e[e.G3=196]="G3",e[e.GSharp3=208]="GSharp3",e[e.A3=220]="A3",e[e.Bb3=233]="Bb3",e[e.B3=247]="B3",e[e.C4=262]="C4",e[e.CSharp4=277]="CSharp4",e[e.D4=294]="D4",e[e.Eb4=311]="Eb4",e[e.E4=330]="E4",e[e.F4=349]="F4",e[e.FSharp4=370]="FSharp4",e[e.G4=392]="G4",e[e.GSharp4=415]="GSharp4",e[e.A4=440]="A4",e[e.Bb4=466]="Bb4",e[e.B4=494]="B4",e[e.C5=523]="C5",e[e.CSharp5=555]="CSharp5",e[e.D5=587]="D5",e[e.Eb5=622]="Eb5",e[e.E5=659]="E5",e[e.F5=698]="F5",e[e.FSharp5=740]="FSharp5",e[e.G5=784]="G5",e[e.GSharp5=831]="GSharp5",e[e.A5=880]="A5",e[e.Bb5=932]="Bb5",e[e.B5=988]="B5",e[e.C6=1047]="C6",e[e.CSharp6=1109]="CSharp6",e[e.D6=1175]="D6",e[e.Eb6=1245]="Eb6",e[e.E6=1319]="E6",e[e.F6=1397]="F6",e[e.FSharp6=1480]="FSharp6",e[e.G6=1568]="G6",e[e.GSharp6=1568]="GSharp6",e[e.A6=1760]="A6",e[e.Bb6=1865]="Bb6",e[e.B6=1976]="B6",e[e.C7=2093]="C7"}(t||(t={}));var o={28:{name:"C",prefixedName:"Low C",freq:131},29:{name:"C#",prefixedName:"Low C#",freq:139},30:{name:"D",prefixedName:"Low D",freq:147},31:{name:"D#",prefixedName:"Low D#",freq:156},32:{name:"E",prefixedName:"Low E",freq:165},33:{name:"F",prefixedName:"Low F",freq:175},34:{name:"F#",prefixedName:"Low F#",freq:185},35:{name:"G",prefixedName:"Low G",freq:196},36:{name:"G#",prefixedName:"Low G#",freq:208},37:{name:"A",prefixedName:"Low A",freq:220},38:{name:"A#",prefixedName:"Low A#",freq:233},39:{name:"B",prefixedName:"Low B",freq:247},40:{name:"C",prefixedName:"Middle C",freq:262},41:{name:"C#",prefixedName:"Middle C#",freq:277},42:{name:"D",prefixedName:"Middle D",freq:294},43:{name:"D#",prefixedName:"Middle D#",freq:311},44:{name:"E",prefixedName:"Middle E",freq:330},45:{name:"F",prefixedName:"Middle F",freq:349},46:{name:"F#",prefixedName:"Middle F#",freq:370},47:{name:"G",prefixedName:"Middle G",freq:392},48:{name:"G#",prefixedName:"Middle G#",freq:415},49:{name:"A",prefixedName:"Middle A",freq:440},50:{name:"A#",prefixedName:"Middle A#",freq:466},51:{name:"B",prefixedName:"Middle B",freq:494},52:{name:"C",prefixedName:"Tenor C",altPrefixedName:"High C",freq:523},53:{name:"C#",prefixedName:"Tenor C#",altPrefixedName:"High C#",freq:554},54:{name:"D",prefixedName:"Tenor D",altPrefixedName:"High D",freq:587},55:{name:"D#",prefixedName:"Tenor D#",altPrefixedName:"High D#",freq:622},56:{name:"E",prefixedName:"Tenor E",altPrefixedName:"High E",freq:659},57:{name:"F",prefixedName:"Tenor F",altPrefixedName:"High F",freq:698},58:{name:"F#",prefixedName:"Tenor F#",altPrefixedName:"High F#",freq:740},59:{name:"G",prefixedName:"Tenor G",altPrefixedName:"High G",freq:784},60:{name:"G#",prefixedName:"Tenor G#",altPrefixedName:"High G#",freq:831},61:{name:"A",prefixedName:"Tenor A",altPrefixedName:"High A",freq:880},62:{name:"A#",prefixedName:"Tenor A#",altPrefixedName:"High A#",freq:932},63:{name:"B",prefixedName:"Tenor B",altPrefixedName:"High B",freq:988},64:{name:"C",prefixedName:"High C",freq:1046},65:{name:"C#",prefixedName:"High C#",freq:1109},66:{name:"D",prefixedName:"High D",freq:1175},67:{name:"D#",prefixedName:"High D#",freq:1245},68:{name:"E",prefixedName:"High E",freq:1319},69:{name:"F",prefixedName:"High F",freq:1397},70:{name:"F#",prefixedName:"High F#",freq:1478},71:{name:"G",prefixedName:"High G",freq:1568},72:{name:"G#",prefixedName:"High G#",freq:1661},73:{name:"A",prefixedName:"High A",freq:1760},74:{name:"A#",prefixedName:"High A#",freq:1865},75:{name:"B",prefixedName:"High B",freq:1976}},i=/^Note\.(.+)$/,r=function(r){function n(t,o,i){r.call(this,t),this.isFieldCustom_=!0,this.nKeys_=36,this.minNote_=28,this.maxNote_=63,this.eps=2,this.noteFreq_=[],this.noteName_=[],n.superClass_.constructor.call(this,t,i),this.note_=t,o.editorColour&&(this.colour_=e.parseColour(o.editorColour),this.colourBorder_=goog.color.rgbArrayToHex(goog.color.darken(goog.color.hexToRgb(this.colour_),.2)));var l=parseInt(o.minNote)||this.minNote_,a=parseInt(o.maxNote)||this.maxNote_;l>=28&&a<=76&&a>l&&(this.minNote_=l,this.maxNote_=a,this.nKeys_=this.maxNote_-this.minNote_+1)}return __extends(n,r),n.prototype.classValidator=function(e){if(null===e)return null;e=String(e);var t=parseFloat(e||"0");return isNaN(t)||t<0?null:String(t)},n.prototype.init=function(){n.superClass_.init.call(this),this.noteFreq_.length=0,this.noteName_.length=0;var e=this;!function(){for(var t=e.minNote_;t<=e.maxNote_;t++){var i=o[t].prefixedName;e.nKeys_<13?i=o[t].name:e.minNote_>=28&&e.maxNote_<=63&&(i=o[t].altPrefixedName||i),e.noteName_.push(i),e.noteFreq_.push(o[t].freq)}}(),this.setValue(this.callValidator(this.getValue()))},n.prototype.getValue=function(){return this.note_},n.prototype.setValue=function(e){var o=i.exec(e),r=o&&o.length>1?o[1]:null;e=t[r]?t[r]:String(parseFloat(e||"0")),isNaN(Number(e))||Number(e)<0||(this.sourceBlock_&&Blockly.Events.isEnabled()&&this.note_!=e&&Blockly.Events.fire(new Blockly.Events.Change(this.sourceBlock_,"field",this.name,String(this.note_),String(e))),this.note_=this.callValidator(e),this.setText(this.getNoteName_()))},n.prototype.getText=function(){return Math.floor(Number(this.note_))==Number(this.note_)?Number(this.note_).toFixed(0):Number(this.note_).toFixed(2)},n.prototype.setText=function(e){null!==e&&(e=String(e),isNaN(Number(e))||(e=this.getNoteName_()),e!==this.text_&&Blockly.Field.prototype.setText.call(this,e))},n.prototype.getNoteName_=function(){for(var e=this.getValue(),t=e.toString(),o=0;o<this.nKeys_;o++)if(Math.abs(this.noteFreq_[o]-Number(e))<this.eps)return this.noteName_[o];return isNaN(Number(e))||(t+=" Hz"),t},n.prototype.setNumberOfKeys=function(e){return this.nKeys_=e,this},n.prototype.onHtmlInputChange_=function(e){r.prototype.onHtmlInputChange_.call(this,e),Blockly.DropDownDiv.hideWithoutAnimation()},n.prototype.showEditor_=function(t){function o(){var t,o=++f,i=this.getContent().getAttribute("tag");null!=E&&((t=E.getContent()).style.backgroundColor=T),t=this.getContent(),E!==this&&(T=t.style.backgroundColor,g.setValue(g.callValidator(i)),g.setText(g.callValidator(i))),E=this,t.style.backgroundColor=m,Blockly.FieldTextInput.htmlInput_.value=g.getText(),e.AudioContextManager.tone(i),setTimeout(function(){f==o&&e.AudioContextManager.stop()},300),n.superClass_.dispose.call(this)}function i(e,t,o,i){var r=(o?0:a/2)+t,n=u+p+e;i&&(n=u+e);var l=goog.dom.createDom("div",{style:"top: "+n+"px; left: "+r+"px; ;"+(i?"height: "+d+"px; font-size:"+(d-10)+"px;":"")+"width: "+Math.ceil(a/2)+"px;background-color: "+g.colour_+";"+(o?"border-left-color: ":"border-right-color: ")+g.colour_+";"+(i?"":"border-bottom-color: "+g.colour_)+";"});return l.className="blocklyNotePrevNext",l}function r(e){var t=e%12;return 1!=t&&3!=t&&6!=t&&8!=t&&10!=t}this.colour_||(this.colour_=this.sourceBlock_.isShadow()?this.sourceBlock_.parentBlock_.getColour():this.sourceBlock_.getColour(),this.colourBorder_=this.sourceBlock_.isShadow()?this.sourceBlock_.parentBlock_.getColourTertiary():this.sourceBlock_.getColourTertiary()),Blockly.DropDownDiv.hideWithoutAnimation(),Blockly.DropDownDiv.clearContent();var l=Blockly.DropDownDiv.getContentDiv();Blockly.FieldNumber.prototype.setText.call(this,this.getText()),n.superClass_.showEditor_.call(this,!0);var a,s,c=22,u=90,p=24,d=20,h=0,m="yellowgreen",f=0,g=this,b=!1,k=!1,y=goog.dom.getViewportSize().width,v=[];a=c*(this.nKeys_-this.nKeys_/12*5),s=u+p;for(B=0;B<this.nKeys_;B++)v.push(new goog.ui.CustomButton);y<a&&(b=!0,a=7*c,s=u+p+d),t||!1||!goog.userAgent.MOBILE&&!goog.userAgent.ANDROID||(b=!0,k=!0,a=7*(c*=2),s=(u*=2)+(p*=1.2)+(d*=2));var _=goog.dom.createDom("div",{});_.className="blocklyPianoDiv",l.appendChild(_);goog.style.getViewportPageOffset(document),this.getAbsoluteXY_(),this.getScaledBBox_();Blockly.Events.setGroup(!0);for(var T,x=0,E=null,B=0;B<this.nKeys_;B++){B>0&&B%12==0&&x++;var A=v[B],C=r(B)?"white":"black",N=function(e){return r(e)?c:c/2}(B),w=function(e){return r(e)?u:u/2}(B),I=function(e){var t=h*c;return r(e)?t:t-c/4}(B);b&&B>=12&&(I-=7*x*c);var S=function(e,t,o,i,r,n,l,a){var s=goog.dom.createDom("div",{style:"background-color: "+e+"; width: "+t+"px; height: "+o+"px; left: "+i+"px; top: "+r+"px; z-index: "+n+";   border-color: "+l+";"});return s.className="blocklyNote",s}(C,N,w,I+0,0,r(B)?1e3:1001,r(B)?this.colour_:"black");A.setContent(S),A.setId(this.noteName_[B]),A.render(_),(V=A.getContent()).setAttribute("tag",this.noteFreq_[B].toString()),Math.abs(this.noteFreq_[B]-Number(this.getValue()))<this.eps&&(T=V.style.backgroundColor,V.style.backgroundColor=m,E=A),k?goog.events.listen(A.getElement(),goog.events.EventType.TOUCHSTART,o,!1,A):goog.events.listen(A.getElement(),goog.events.EventType.MOUSEDOWN,o,!1,A),goog.events.listen(A.getElement(),goog.events.EventType.MOUSEOVER,function(){D.getContent().textContent=this.getId()},!1,A),r(B)&&h++,b&&B>11&&A.setVisible(!1)}var D=new goog.ui.CustomButton,O=function(e,t,o){e+=u,o&&(e+=d);var i=goog.dom.createDom("div",{style:"top: "+e+"px; left: "+t+"px; background-color: "+g.colour_+"; width: "+a+"px; border-color: "+g.colour_+";"+(o?" font-size: "+(p-10)+"px; height: "+p+"px;":"")});return i.className="blocklyNoteLabel",i}(0,0,k);D.setContent(O),D.render(_);var L=D.getContent();L.textContent="-";var F=new goog.ui.CustomButton,R=new goog.ui.CustomButton,P=i(0,0,!0,k),M=i(0,0,!1,k);if(b){L.textContent="Octave #1";var V=void 0;F.setContent(P),F.render(_),(V=F.getContent()).textContent="<",R.setContent(M),R.render(_),(V=R.getContent()).textContent=">";var U=this.nKeys_/12,H=0;goog.events.listen(F.getElement(),goog.events.EventType.MOUSEDOWN,function(){if(0!=H){for(var e=12*H,t=12*H-12,o=0;o<12;o++)v[o+e].setVisible(!1);for(o=0;o<12;o++)v[o+t].setVisible(!0);H--,L.textContent="Octave #"+(H+1)}else L.textContent="Octave #"+(H+1)},!1,F),goog.events.listen(R.getElement(),goog.events.EventType.MOUSEDOWN,function(){if(H!=U-1){for(var e=12*H,t=12*H+12,o=0;o<12;o++)v[o+e].setVisible(!1);for(o=0;o<12;o++)v[o+t].setVisible(!0);H++,L.textContent="Octave #"+(H+1)}else L.textContent="Octave #"+(H+1)},!1,R)}_.style.width=a+"px",_.style.height=s+1+"px",Blockly.DropDownDiv.setColour(this.colour_,this.colourBorder_);var G=this.sourceBlock_.workspace.scale,W={width:this.size_.width,height:this.size_.height};W.width*=G,W.height*=G;var X=this.fieldGroup_.getBoundingClientRect(),q=X.left+W.width/2,Y=X.top+W.height,j=q,z=X.top;Blockly.DropDownDiv.setBoundsElement(this.sourceBlock_.workspace.getParentSvg().parentNode),Blockly.DropDownDiv.show(this,q,Y,j,z,this.onHide.bind(this))},n.prototype.onHide=function(){},n.prototype.dispose=function(){Blockly.DropDownDiv.hideIfOwner(this),Blockly.FieldTextInput.superClass_.dispose.call(this)},n}(Blockly.FieldNumber);e.FieldNote=r}(pxtblockly||(pxtblockly={}));var pxtblockly;!function(e){var t=function(e){function t(t,o,i){e.call(this,t,o.data,o.min,o.max,o.precision,i),this.isFieldCustom_=!0}return __extends(t,e),t.prototype.getOptions=function(){var e;return this.menuGenerator_&&(e=JSON.parse(this.menuGenerator_).map(function(e){return"object"==typeof e?e:[String(e),String(e)]})),e},t}(Blockly.FieldNumberDropdown);e.FieldNumberDropdown=t}(pxtblockly||(pxtblockly={}));var pxtblockly;!function(e){var t=function(e){function t(t,o){e.call(this,null,o),this.setValue(t||"")}return __extends(t,e),t.prototype.getOptions=function(){return this.dropdownCreate()},t.prototype.init=function(){this.fieldGroup_||e.prototype.init.call(this)},t.prototype.setSourceBlock=function(t){goog.asserts.assert(!t.isShadow(),"Procedure fields are not allowed to exist on shadow blocks."),e.prototype.setSourceBlock.call(this,t)},t.prototype.getValue=function(){return this.getText()},t.prototype.setValue=function(e){this.sourceBlock_&&Blockly.Events.isEnabled()&&Blockly.Events.fire(new Blockly.Events.Change(this.sourceBlock_,"field",this.name,this.value_,e)),this.value_=e,this.setText(e)},t.prototype.dropdownCreate=function(){var e=[];if(this.sourceBlock_&&this.sourceBlock_.workspace)for(var t=this.sourceBlock_.workspace.getAllBlocks(),o=0;o<t.length;o++)if(t[o].getProcedureDef){var i=t[o].getProcedureDef();e.push(i[0])}var r=this.getText();r&&-1==e.indexOf(r)&&e.push(r),e.sort(goog.string.caseInsensitiveCompare),e.length||e.push("Temp");for(var n=[],o=0;o<e.length;o++)n[o]=[e[o],e[o]];return n},t.prototype.onItemSelected=function(e,t){var o=t.getValue();this.sourceBlock_&&(o=this.callValidator(o)),null!==o&&this.setValue(o)},t}(Blockly.FieldDropdown);e.FieldProcedure=t}(pxtblockly||(pxtblockly={}));var pxtblockly;!function(e){var t=function(e){function t(t,o,i){e.call(this,t,o.values,i),this.isFieldCustom_=!0}return __extends(t,e),t}(Blockly.FieldTextDropdown);e.FieldTextDropdown=t}(pxtblockly||(pxtblockly={}));var pxtblockly;!function(e){var t=function(e){function t(t,o,i){e.call(this,t,i),this.isFieldCustom_=!0}return __extends(t,e),t}(Blockly.FieldTextInput);e.FieldTextInput=t}(pxtblockly||(pxtblockly={}));var pxtblockly;!function(e){var t=function(t){function o(e,o,i){t.call(this,e,i),this.isFieldCustom_=!0,this.CURSOR="pointer",this.params=o,this.setValue(e),this.addArgType("toggle"),this.type_=o.type}return __extends(o,t),o.prototype.init=function(){if(!this.fieldGroup_){this.fieldGroup_=Blockly.utils.createSvgElement("g",{},null),this.visible_||(this.fieldGroup_.style.display="none"),null!==this.getArgTypes()&&(this.sourceBlock_.isShadow()?this.sourceBlock_.svgGroup_.setAttribute("data-argument-type",this.getArgTypes()):this.fieldGroup_.setAttribute("data-argument-type",this.getArgTypes())),!this.sourceBlock_.isShadow()&&this.sourceBlock_.inputList&&this.sourceBlock_.inputList.length>1&&(this.box_=Blockly.utils.createSvgElement("rect",{rx:Blockly.BlockSvg.CORNER_RADIUS,ry:Blockly.BlockSvg.CORNER_RADIUS,x:0,y:0,width:this.size_.width,height:this.size_.height,fill:Blockly.Colours.textField,stroke:this.sourceBlock_.getColourTertiary()}),this.fieldGroup_.insertBefore(this.box_,this.textElement_));var e=this.getSize();switch(this.checkElement_=Blockly.utils.createSvgElement("g",{class:"blocklyToggle "+(this.state_?"blocklyToggleOn":"blocklyToggleOff"),transform:"translate(8, "+e.height/2+")"},this.fieldGroup_),this.getOutputShape()){case Blockly.OUTPUT_SHAPE_HEXAGONAL:this.toggleThumb_=Blockly.utils.createSvgElement("polygon",{class:"blocklyToggleRect",points:"-7,-14 -21,0 -7,14 7,14 21,0 7,-14",cursor:"pointer"},this.checkElement_);break;case Blockly.OUTPUT_SHAPE_ROUND:this.toggleThumb_=Blockly.utils.createSvgElement("rect",{class:"blocklyToggleCircle",x:-6,y:-14,height:28,width:28,rx:14,ry:14,cursor:"pointer"},this.checkElement_);break;case Blockly.OUTPUT_SHAPE_SQUARE:this.toggleThumb_=Blockly.utils.createSvgElement("rect",{class:"blocklyToggleRect",x:-6,y:-14,height:28,width:28,rx:3,ry:3,cursor:"pointer"},this.checkElement_)}var t=this.sourceBlock_.RTL?-e.width/2:e.width/2;this.textElement_=Blockly.utils.createSvgElement("text",{class:"blocklyText",x:t,dy:"0.6ex",y:e.height/2},this.fieldGroup_),this.updateEditable(),this.sourceBlock_.getSvgRoot().appendChild(this.fieldGroup_),this.switchToggle(this.state_),this.setValue(this.getValue()),this.render_(),this.size_.width=0,this.mouseDownWrapper_=Blockly.bindEventWithChecks_(this.getClickTarget_(),"mousedown",this,this.onMouseDown_)}},o.prototype.getDisplayText_=function(){return this.state_?this.getTrueText():this.getFalseText()},o.prototype.getTrueText=function(){return lf("True")},o.prototype.getFalseText=function(){return lf("False")},o.prototype.updateWidth=function(){this.getInnerWidth();switch(this.getOutputShape()){case Blockly.OUTPUT_SHAPE_ROUND:this.size_.width=2*this.getInnerWidth()-7;break;case Blockly.OUTPUT_SHAPE_HEXAGONAL:this.size_.width=2*this.getInnerWidth()+8-Math.floor(this.getInnerWidth()/2);break;case Blockly.OUTPUT_SHAPE_SQUARE:this.size_.width=9+2*this.getInnerWidth()}this.arrowWidth_=0},o.prototype.getInnerWidth=function(){return 10*this.getMaxLength()},o.prototype.getMaxLength=function(){return Math.max(this.getTrueText().length,this.getFalseText().length)},o.prototype.getOutputShape=function(){return this.sourceBlock_.isShadow()?this.sourceBlock_.getOutputShape():Blockly.OUTPUT_SHAPE_SQUARE},o.prototype.getValue=function(){return this.toVal(this.state_)},o.prototype.setValue=function(e){var t=this.fromVal(e);this.state_!==t&&(this.sourceBlock_&&Blockly.Events.isEnabled()&&Blockly.Events.fire(new Blockly.Events.BlockChange(this.sourceBlock_,"field",this.name,this.state_,t)),this.state_=t,this.switchToggle(this.state_),this.setText(this.getDisplayText_()))},o.prototype.switchToggle=function(t){if(this.checkElement_){this.updateWidth();var o=this.getSize(),i=this.getInnerWidth();t?(e.svg.addClass(this.checkElement_,"blocklyToggleOn"),e.svg.removeClass(this.checkElement_,"blocklyToggleOff")):(e.svg.removeClass(this.checkElement_,"blocklyToggleOn"),e.svg.addClass(this.checkElement_,"blocklyToggleOff"));var r=this.getOutputShape(),n=0,l=0,a=0,s=0;switch(r){case Blockly.OUTPUT_SHAPE_HEXAGONAL:var c=(l=(n=i)/2)/2;a=this.getMaxLength()>3?-4:1,s=-c;var u=-c,p=c;this.toggleThumb_.setAttribute("points",u+",-14 "+(u-14)+",0 "+u+",14 "+p+",14 "+(p+14)+",0 "+p+",-14");break;case Blockly.OUTPUT_SHAPE_ROUND:case Blockly.OUTPUT_SHAPE_SQUARE:l=(n=5+i)/2,this.toggleThumb_.setAttribute("width",n),this.toggleThumb_.setAttribute("x","-"+l),a=s=r==Blockly.OUTPUT_SHAPE_SQUARE?2:-6}this.checkElement_.setAttribute("transform","translate("+(t?s+i+l:l+a)+", "+o.height/2+")")}},o.prototype.updateTextNode_=function(){t.prototype.updateTextNode_.call(this),this.textElement_&&e.svg.addClass(this.textElement_,"blocklyToggleText")},o.prototype.render_=function(){if(this.visible_&&this.textElement_){goog.dom.removeChildren(this.textElement_);var t=document.createTextNode(this.getDisplayText_());this.textElement_.appendChild(t),e.svg.addClass(this.textElement_,"blocklyToggleText"),this.updateWidth();var o=this.size_.width/2,i=(this.state_?o+o/2:o/2)-Blockly.Field.getCachedWidth(this.textElement_)/2;this.textElement_.setAttribute("x",""+i)}this.box_&&(this.box_.setAttribute("width",""+this.size_.width),this.box_.setAttribute("height",""+this.size_.height))},o.prototype.showEditor_=function(){var e=!this.state_;null!==e&&this.setValue(this.toVal(e))},o.prototype.toVal=function(e){return"number"==this.type_?String(e?"1":"0"):String(e?"true":"false")},o.prototype.fromVal=function(e){return"string"==typeof e?"1"==e||"TRUE"==e.toUpperCase():!!e},o}(Blockly.FieldNumber);e.FieldToggle=t}(pxtblockly||(pxtblockly={}));var pxtblockly;!function(e){var t=function(e){function t(t,o,i){e.call(this,t,o,i),this.isFieldCustom_=!0}return __extends(t,e),t.prototype.getTrueText=function(){return lf("ON")},t.prototype.getFalseText=function(){return lf("OFF")},t}(e.FieldToggle);e.FieldToggleOnOff=t}(pxtblockly||(pxtblockly={}));var pxtblockly;!function(e){var t=function(e){function t(t,o,i){e.call(this,t,o,i),this.isFieldCustom_=!0}return __extends(t,e),t.prototype.getTrueText=function(){return lf("Yes")},t.prototype.getFalseText=function(){return lf("No")},t}(e.FieldToggle);e.FieldToggleYesNo=t}(pxtblockly||(pxtblockly={}));var pxtblockly;!function(e){var t=function(e){function t(){e.apply(this,arguments),this.isFieldCustom_=!0}return __extends(t,e),t.prototype.updateEditable=function(){var e=this.fieldGroup_;this.EDITABLE&&e&&(this.sourceBlock_.isEditable()?(Blockly.utils.addClass(e,"blocklyEditableText"),Blockly.utils.removeClass(e,"blocklyGreyExpressionBlockText"),this.fieldGroup_.style.cursor=this.CURSOR):(Blockly.utils.addClass(e,"blocklyGreyExpressionBlockText"),Blockly.utils.removeClass(e,"blocklyEditableText"),this.fieldGroup_.style.cursor=""))},t}(Blockly.FieldTextInput);e.FieldTsExpression=t}(pxtblockly||(pxtblockly={}));var pxtblockly;!function(e){!function(e){e.hasClass=function(e,t){return e.classList?e.classList.contains(t):e.className.baseVal.indexOf(t)>-1},e.addClass=function(e,t){e.classList?e.classList.add(t):e.className.baseVal.indexOf(t)<0&&(e.className.baseVal+=" "+t)},e.removeClass=function(e,t){e.classList?e.classList.remove(t):e.className.baseVal=e.className.baseVal.replace(t,"").replace(/\s{2,}/," ")}}(e.svg||(e.svg={})),e.parseColour=function(e){var t=Number(e);return isNaN(t)?goog.isString(e)&&e.match(/^#[0-9a-fA-F]{6}$/)?e:"#000":Blockly.hueToRgb(t)};!function(e){function t(){return r||(r=o()),r}function o(){if(window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext)try{return new window.AudioContext}catch(e){}}function i(){r&&(n.disconnect(),l=0)}var r,n,l=0,a=!1;e.mute=function(e){r&&(a=e,i())},e.stop=i,e.frequency=function(){return l},e.tone=function(e){if(!(a||e<=0)){l=e;var o=t();if(o)try{n&&(n.disconnect(),n=void 0),(n=o.createOscillator()).frequency.value=e,n.type="triangle",n.connect(o.destination),n.start(0)}catch(e){return void(n=void 0)}}}}(e.AudioContextManager||(e.AudioContextManager={}))}(pxtblockly||(pxtblockly={}));